<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Orville.PostgreSQL.AutoMigration</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">orville-postgresql-libpq-0.10.0.0: ORM</span><ul class="links" id="page-menu"><li><a href="src/Orville.PostgreSQL.AutoMigration.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Orville.PostgreSQL.AutoMigration</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:autoMigrateSchema">autoMigrateSchema</a> :: <a href="Orville-PostgreSQL.html#t:MonadOrville" title="Orville.PostgreSQL">MonadOrville</a> m =&gt; [<a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a>] -&gt; m ()</li><li class="src short"><a href="#v:generateMigrationSteps">generateMigrationSteps</a> :: <a href="Orville-PostgreSQL.html#t:MonadOrville" title="Orville.PostgreSQL">MonadOrville</a> m =&gt; [<a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a>] -&gt; m [<a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a>]</li><li class="src short"><a href="#v:executeMigrationSteps">executeMigrationSteps</a> :: <a href="Orville-PostgreSQL.html#t:MonadOrville" title="Orville.PostgreSQL">MonadOrville</a> m =&gt; [<a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a>] -&gt; m ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:SchemaItem">SchemaItem</a> <span class="keyword">where</span><ul class="subs"><li><a href="#v:SchemaTable">SchemaTable</a> :: <a href="Orville-PostgreSQL-Internal-TableDefinition.html#t:TableDefinition" title="Orville.PostgreSQL.Internal.TableDefinition">TableDefinition</a> key writeEntity readEntity -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></li><li><a href="#v:SchemaDropTable">SchemaDropTable</a> :: <a href="Orville-PostgreSQL-Internal-TableIdentifier.html#t:TableIdentifier" title="Orville.PostgreSQL.Internal.TableIdentifier">TableIdentifier</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></li><li><a href="#v:SchemaSequence">SchemaSequence</a> :: <a href="Orville-PostgreSQL-Internal-SequenceDefinition.html#t:SequenceDefinition" title="Orville.PostgreSQL.Internal.SequenceDefinition">SequenceDefinition</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></li><li><a href="#v:SchemaDropSequence">SchemaDropSequence</a> :: <a href="Orville-PostgreSQL-Internal-SequenceIdentifier.html#t:SequenceIdentifier" title="Orville.PostgreSQL.Internal.SequenceIdentifier">SequenceIdentifier</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></li></ul></li><li class="src short"><a href="#v:schemaItemSummary">schemaItemSummary</a> :: <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a> -&gt; <a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:MigrationStep">MigrationStep</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:MigrationDataError">MigrationDataError</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:autoMigrateSchema" class="def">autoMigrateSchema</a> :: <a href="Orville-PostgreSQL.html#t:MonadOrville" title="Orville.PostgreSQL">MonadOrville</a> m =&gt; [<a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a>] -&gt; m () <a href="src/Orville.PostgreSQL.AutoMigration.html#autoMigrateSchema" class="link">Source</a> <a href="#v:autoMigrateSchema" class="selflink">#</a></p><div class="doc"><p>This function compares the list of <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code>s provided against the current
  schema found in the database to determine whether any migration are
  necessary.  If any changes need to be made, this function executes. You can
  call <code><a href="Orville-PostgreSQL-AutoMigration.html#v:generateMigrationSteps" title="Orville.PostgreSQL.AutoMigration">generateMigrationSteps</a></code> and <code><a href="Orville-PostgreSQL-AutoMigration.html#v:executeMigrationSteps" title="Orville.PostgreSQL.AutoMigration">executeMigrationSteps</a></code> yourself if you
  want to have more control over the process.</p></div></div><div class="top"><p class="src"><a id="v:generateMigrationSteps" class="def">generateMigrationSteps</a> :: <a href="Orville-PostgreSQL.html#t:MonadOrville" title="Orville.PostgreSQL">MonadOrville</a> m =&gt; [<a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a>] -&gt; m [<a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a>] <a href="src/Orville.PostgreSQL.AutoMigration.html#generateMigrationSteps" class="link">Source</a> <a href="#v:generateMigrationSteps" class="selflink">#</a></p><div class="doc"><p>Compares the list of <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code>s provided against the current schema
  found in the database and returns a list of <code><a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a></code>s that could be
  executed to make the database schema match the items given.</p><p>You can execute the <code><a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a></code>s yourself using <code><a href="Orville-PostgreSQL.html#v:executeVoid" title="Orville.PostgreSQL">executeVoid</a></code>,
  or use the <code><a href="Orville-PostgreSQL-AutoMigration.html#v:executeMigrationSteps" title="Orville.PostgreSQL.AutoMigration">executeMigrationSteps</a></code> convenience function.</p></div></div><div class="top"><p class="src"><a id="v:executeMigrationSteps" class="def">executeMigrationSteps</a> :: <a href="Orville-PostgreSQL.html#t:MonadOrville" title="Orville.PostgreSQL">MonadOrville</a> m =&gt; [<a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a>] -&gt; m () <a href="src/Orville.PostgreSQL.AutoMigration.html#executeMigrationSteps" class="link">Source</a> <a href="#v:executeMigrationSteps" class="selflink">#</a></p><div class="doc"><p>A convenience function for executing a list of <code><a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a></code>s that has
  be previously devised via <code><a href="Orville-PostgreSQL-AutoMigration.html#v:generateMigrationSteps" title="Orville.PostgreSQL.AutoMigration">generateMigrationSteps</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SchemaItem" class="def">SchemaItem</a> <span class="keyword">where</span> <a href="src/Orville.PostgreSQL.AutoMigration.html#SchemaItem" class="link">Source</a> <a href="#t:SchemaItem" class="selflink">#</a></p><div class="doc"><p>A <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code> represents a single item in a database schema such as a table,
  index or constraint. The constructor functions below can be used to create
  items from other types (such as <code><a href="Orville-PostgreSQL-Internal-TableDefinition.html#t:TableDefinition" title="Orville.PostgreSQL.Internal.TableDefinition">TableDefinition</a></code>) to put them into
  a list to be used with <code><a href="Orville-PostgreSQL-AutoMigration.html#v:autoMigrateSchema" title="Orville.PostgreSQL.AutoMigration">autoMigrateSchema</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SchemaTable" class="def">SchemaTable</a> :: <a href="Orville-PostgreSQL-Internal-TableDefinition.html#t:TableDefinition" title="Orville.PostgreSQL.Internal.TableDefinition">TableDefinition</a> key writeEntity readEntity -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></td><td class="doc"><p>Constructs a <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code> from a <code><a href="Orville-PostgreSQL-Internal-TableDefinition.html#t:TableDefinition" title="Orville.PostgreSQL.Internal.TableDefinition">TableDefinition</a></code>.</p></td></tr><tr><td class="src"><a id="v:SchemaDropTable" class="def">SchemaDropTable</a> :: <a href="Orville-PostgreSQL-Internal-TableIdentifier.html#t:TableIdentifier" title="Orville.PostgreSQL.Internal.TableIdentifier">TableIdentifier</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></td><td class="doc"><p>Constructs a <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code> that will drop the specified table if it is
    found in the database.</p></td></tr><tr><td class="src"><a id="v:SchemaSequence" class="def">SchemaSequence</a> :: <a href="Orville-PostgreSQL-Internal-SequenceDefinition.html#t:SequenceDefinition" title="Orville.PostgreSQL.Internal.SequenceDefinition">SequenceDefinition</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></td><td class="doc"><p>Constructs a <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code> from a <code><a href="Orville-PostgreSQL-Internal-SequenceDefinition.html#t:SequenceDefinition" title="Orville.PostgreSQL.Internal.SequenceDefinition">SequenceDefinition</a></code>.</p></td></tr><tr><td class="src"><a id="v:SchemaDropSequence" class="def">SchemaDropSequence</a> :: <a href="Orville-PostgreSQL-Internal-SequenceIdentifier.html#t:SequenceIdentifier" title="Orville.PostgreSQL.Internal.SequenceIdentifier">SequenceIdentifier</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></td><td class="doc"><p>Constructs a <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code> that will drop the specified table if it is
    found in the database.</p></td></tr></table></div></div><div class="top"><p class="src"><a id="v:schemaItemSummary" class="def">schemaItemSummary</a> :: <a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a> -&gt; <a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="src/Orville.PostgreSQL.AutoMigration.html#schemaItemSummary" class="link">Source</a> <a href="#v:schemaItemSummary" class="selflink">#</a></p><div class="doc"><p>Returns a one-line string describe the <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code>, suitable for a human to
  identify it in a list of output.</p><p>For example, a <code><a href="Orville-PostgreSQL-AutoMigration.html#t:SchemaItem" title="Orville.PostgreSQL.AutoMigration">SchemaItem</a></code> constructed via <code>schemaTable</code> gives <code>Table &lt;table
  name&gt;</code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MigrationStep" class="def">MigrationStep</a> <a href="src/Orville.PostgreSQL.AutoMigration.html#MigrationStep" class="link">Source</a> <a href="#t:MigrationStep" class="selflink">#</a></p><div class="doc"><p>A single SQL statement that will be executed in order to migrate the database
  to the desired result. You can use <code><a href="Orville-PostgreSQL-AutoMigration.html#v:generateMigrationSteps" title="Orville.PostgreSQL.AutoMigration">generateMigrationSteps</a></code> to get a list
  of these yourself for inspection and debugging.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:MigrationStep">Instances</h4><details id="i:MigrationStep" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:MigrationStep:SqlExpression:1"></span> <a href="Orville-PostgreSQL-Internal-RawSql.html#t:SqlExpression" title="Orville.PostgreSQL.Internal.RawSql">SqlExpression</a> <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a></span> <a href="src/Orville.PostgreSQL.AutoMigration.html#line-91" class="link">Source</a> <a href="#t:MigrationStep" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:MigrationStep:SqlExpression:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Orville-PostgreSQL-AutoMigration.html">Orville.PostgreSQL.AutoMigration</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toRawSql">toRawSql</a> :: <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a> -&gt; <a href="Orville-PostgreSQL-Internal-RawSql.html#t:RawSql" title="Orville.PostgreSQL.Internal.RawSql">RawSql</a> <a href="src/Orville.PostgreSQL.Internal.RawSql.html#toRawSql" class="link">Source</a> <a href="#v:toRawSql" class="selflink">#</a></p><p class="src"><a href="#v:unsafeFromRawSql">unsafeFromRawSql</a> :: <a href="Orville-PostgreSQL-Internal-RawSql.html#t:RawSql" title="Orville.PostgreSQL.Internal.RawSql">RawSql</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationStep" title="Orville.PostgreSQL.AutoMigration">MigrationStep</a> <a href="src/Orville.PostgreSQL.Internal.RawSql.html#unsafeFromRawSql" class="link">Source</a> <a href="#v:unsafeFromRawSql" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MigrationDataError" class="def">MigrationDataError</a> <a href="src/Orville.PostgreSQL.AutoMigration.html#MigrationDataError" class="link">Source</a> <a href="#t:MigrationDataError" class="selflink">#</a></p><div class="doc"><p>A <code><a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a></code> will be thrown from the migration functions if data
  necessary for migration cannot be found.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:MigrationDataError">Instances</h4><details id="i:MigrationDataError" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:MigrationDataError:Show:1"></span> <a href="../base-4.14.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a></span> <a href="src/Orville.PostgreSQL.AutoMigration.html#line-136" class="link">Source</a> <a href="#t:MigrationDataError" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:MigrationDataError:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Orville-PostgreSQL-AutoMigration.html">Orville.PostgreSQL.AutoMigration</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.14.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a> -&gt; <a href="../base-4.14.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a> -&gt; <a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a>] -&gt; <a href="../base-4.14.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:MigrationDataError:Exception:2"></span> <a href="../base-4.14.1.0/Control-Exception-Base.html#t:Exception" title="Control.Exception.Base">Exception</a> <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a></span> <a href="src/Orville.PostgreSQL.AutoMigration.html#line-138" class="link">Source</a> <a href="#t:MigrationDataError" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:MigrationDataError:Exception:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Orville-PostgreSQL-AutoMigration.html">Orville.PostgreSQL.AutoMigration</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toException">toException</a> :: <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a> -&gt; <a href="../base-4.14.1.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> <a href="#v:toException" class="selflink">#</a></p><p class="src"><a href="#v:fromException">fromException</a> :: <a href="../base-4.14.1.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> -&gt; <a href="../base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a> <a href="#v:fromException" class="selflink">#</a></p><p class="src"><a href="#v:displayException">displayException</a> :: <a href="Orville-PostgreSQL-AutoMigration.html#t:MigrationDataError" title="Orville.PostgreSQL.AutoMigration">MigrationDataError</a> -&gt; <a href="../base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:displayException" class="selflink">#</a></p></div></details></td></tr></table></details></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.0</p></div></body></html>