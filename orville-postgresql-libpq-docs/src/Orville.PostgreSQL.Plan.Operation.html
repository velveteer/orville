<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Orville.PostgreSQL.Plan.Operation</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier">Operation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier">AssertionFailed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#mkAssertionFailed"><span class="hs-identifier">mkAssertionFailed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier">WherePlanner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#byField"><span class="hs-identifier">byField</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#byFieldTuple"><span class="hs-identifier">byFieldTuple</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findOne"><span class="hs-identifier">findOne</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWhere"><span class="hs-identifier">findOneWhere</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findAll"><span class="hs-identifier">findAll</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWhere"><span class="hs-identifier">findAllWhere</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findSelect"><span class="hs-identifier">findSelect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#askParam"><span class="hs-identifier">askParam</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#assertRight"><span class="hs-identifier">assertRight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier">SelectOperation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#selectOperation"><span class="hs-identifier">selectOperation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Exception</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS8</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fold</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Maybe</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.FieldDefinition.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.FieldDefinition</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FieldDefinition</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.MonadOrville</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MonadOrville</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.RawSql</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RawSql</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.Select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier">Select</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.Select</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Select</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.SelectOptions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SelectOptions</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.SqlMarshaller</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SqlMarshaller</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlType.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.SqlType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SqlType</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.TableDefinition</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TableDefinition</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Explanation.html"><span class="hs-identifier">Orville.PostgreSQL.Plan.Explanation</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exp</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html"><span class="hs-identifier">Orville.PostgreSQL.Plan.Many</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier">Many</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html"><span class="hs-identifier">Orville.PostgreSQL.Plan.Many</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Many</span></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">{- |
  'Operation' provides a stucture for building primitive operations that can be
  incorporated into a 'Database.Orville.PostgreSQL.Plan.Plan'. An 'Operation'
  provides base case implementations of the various plan execution functions.
  You only need to care about this type if you want to create new custom
  operations to include in a 'Database.Orville.PostgreSQL.Plan.Plan' beyond
  those already provided in the 'Database.Orville.PostgreSQL.Plan.Plan'
  api.

  You can build your own custom 'Operation' values either directly, or using
  the function and types in this module, such as 'WherePlanner' (via 'findAll',
  etc), or 'SelectOperation' (via 'selectOperation').
-}</span><span>
</span><span id="line-57"></span><span class="hs-keyword">data</span><span> </span><span id="Operation"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-var">Operation</span></a></span></span><span> </span><span id="local-6989586621679124156"><span class="annot"><a href="#local-6989586621679124156"><span class="hs-identifier hs-type">param</span></a></span></span><span> </span><span id="local-6989586621679124155"><span class="annot"><a href="#local-6989586621679124155"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Operation"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-var">Operation</span></a></span></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | 'executeOperationOne' will be called when an plan is</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- executed with a single input parameter</span><span>
</span><span id="line-60"></span><span>    </span><span id="executeOperationOne"><span class="annot"><span class="annottext">Operation param result
-&gt; forall (m :: * -&gt; *).
   MonadOrville m =&gt;
   param -&gt; m (Either AssertionFailed result)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationOne"><span class="hs-identifier hs-var hs-var">executeOperationOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-61"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679124176"><span class="annot"><a href="#local-6989586621679124176"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124176"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><a href="#local-6989586621679124156"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><a href="#local-6989586621679124176"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">AssertionFailed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124155"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'executeOperationMany' will be called when an plan is</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">-- executed with multiple input parameters (via 'planMany').</span><span>
</span><span id="line-67"></span><span>    </span><span id="executeOperationMany"><span class="annot"><span class="annottext">Operation param result
-&gt; forall (m :: * -&gt; *).
   MonadOrville m =&gt;
   NonEmpty param -&gt; m (Either AssertionFailed (Many param result))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationMany"><span class="hs-identifier hs-var hs-var">executeOperationMany</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679124171"><span class="annot"><a href="#local-6989586621679124171"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124171"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679124156"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><a href="#local-6989586621679124171"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">AssertionFailed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124156"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124155"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'explainOperationOne' will be called when producing an explanation</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">-- of what the plan will do when given one input parameter. Plans that do</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- not perform any interesting IO interactions should generally return an</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-comment">-- empty explanation.</span><span>
</span><span id="line-76"></span><span>    </span><span id="explainOperationOne"><span class="annot"><span class="annottext">Operation param result -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationOne"><span class="hs-identifier hs-var hs-var">explainOperationOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Explanation.html#Explanation"><span class="hs-identifier hs-type">Exp.Explanation</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'explainOperationMany' will be called when producing an explanation</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- of what the plan will do when given multiple input parameters (via</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- 'planMany'). Plans that do not perform any interesting IO interactions</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- should generally return an empty explanation.</span><span>
</span><span id="line-81"></span><span>    </span><span id="explainOperationMany"><span class="annot"><span class="annottext">Operation param result -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationMany"><span class="hs-identifier hs-var hs-var">explainOperationMany</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Explanation.html#Explanation"><span class="hs-identifier hs-type">Exp.Explanation</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">{- |
  'AssertionFailed' may be returned from the execute functions of an
  'Operation' to indicate that some expected invariant has failed. For example,
  following a foreign key that is enforced by the database only to find that no
  record exists. When an 'Operation' returns an 'AssertionFailed' value during
  plan execution the error is thrown as an exception using the
  'Control.Monad.Catch.MonadThrow' instance for whatever monad the plan is
  executing in.
-}</span><span>
</span><span id="line-93"></span><span class="hs-keyword">newtype</span><span> </span><span id="AssertionFailed"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-var">AssertionFailed</span></a></span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="AssertionFailed"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-var">AssertionFailed</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679123908"><span id="local-6989586621679123910"><span id="local-6989586621679123912"><span class="annot"><span class="annottext">Int -&gt; AssertionFailed -&gt; ShowS
[AssertionFailed] -&gt; ShowS
AssertionFailed -&gt; String
(Int -&gt; AssertionFailed -&gt; ShowS)
-&gt; (AssertionFailed -&gt; String)
-&gt; ([AssertionFailed] -&gt; ShowS)
-&gt; Show AssertionFailed
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AssertionFailed] -&gt; ShowS
$cshowList :: [AssertionFailed] -&gt; ShowS
show :: AssertionFailed -&gt; String
$cshow :: AssertionFailed -&gt; String
showsPrec :: Int -&gt; AssertionFailed -&gt; ShowS
$cshowsPrec :: Int -&gt; AssertionFailed -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">{- |
  'mkAssertionFailed' builds an 'AssertionFailed' error from an error message.
-}</span><span>
</span><span id="line-100"></span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#mkAssertionFailed"><span class="hs-identifier hs-type">mkAssertionFailed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">AssertionFailed</span></a></span><span>
</span><span id="line-101"></span><span id="mkAssertionFailed"><span class="annot"><span class="annottext">mkAssertionFailed :: String -&gt; AssertionFailed
</span><a href="Orville.PostgreSQL.Plan.Operation.html#mkAssertionFailed"><span class="hs-identifier hs-var hs-var">mkAssertionFailed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; AssertionFailed
</span><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-var">AssertionFailed</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679123899"><span id="local-6989586621679123901"><span id="local-6989586621679123903"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">AssertionFailed</span></a></span></span></span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">{- |
  'askParam' simply returns the paremeter given from the plan.
-}</span><span>
</span><span id="line-109"></span><span id="local-6989586621679123897"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#askParam"><span class="hs-identifier hs-type">askParam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123897"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123897"><span class="hs-identifier hs-type">param</span></a></span></span><span>
</span><span id="line-110"></span><span id="askParam"><span class="annot"><span class="annottext">askParam :: Operation param param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#askParam"><span class="hs-identifier hs-var hs-var">askParam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">Operation :: forall param result.
(forall (m :: * -&gt; *).
 MonadOrville m =&gt;
 param -&gt; m (Either AssertionFailed result))
-&gt; (forall (m :: * -&gt; *).
    MonadOrville m =&gt;
    NonEmpty param -&gt; m (Either AssertionFailed (Many param result)))
-&gt; Explanation
-&gt; Explanation
-&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executeOperationOne :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
param -&gt; m (Either AssertionFailed param)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationOne"><span class="hs-identifier hs-var">executeOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either AssertionFailed param -&gt; m (Either AssertionFailed param)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either AssertionFailed param -&gt; m (Either AssertionFailed param))
-&gt; (param -&gt; Either AssertionFailed param)
-&gt; param
-&gt; m (Either AssertionFailed param)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">param -&gt; Either AssertionFailed param
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeOperationMany :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
NonEmpty param -&gt; m (Either AssertionFailed (Many param param))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationMany"><span class="hs-identifier hs-var">executeOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123895"><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123895"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either AssertionFailed (Many param param)
-&gt; m (Either AssertionFailed (Many param param))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either AssertionFailed (Many param param)
 -&gt; m (Either AssertionFailed (Many param param)))
-&gt; (Many param param -&gt; Either AssertionFailed (Many param param))
-&gt; Many param param
-&gt; m (Either AssertionFailed (Many param param))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Many param param -&gt; Either AssertionFailed (Many param param)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Many param param -&gt; m (Either AssertionFailed (Many param param)))
-&gt; Many param param
-&gt; m (Either AssertionFailed (Many param param))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[param] -&gt; (param -&gt; Either NotAKey param) -&gt; Many param param
forall k a. [k] -&gt; (k -&gt; Either NotAKey a) -&gt; Many k a
</span><a href="Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty param -&gt; [param]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123895"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">param -&gt; Either NotAKey param
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationOne :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationOne"><span class="hs-identifier hs-var">explainOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#noExplanation"><span class="hs-identifier hs-var">Exp.noExplanation</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationMany :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationMany"><span class="hs-identifier hs-var">explainOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#noExplanation"><span class="hs-identifier hs-var">Exp.noExplanation</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">{- |
  'assertRight' returns the value on the 'Right' side of an 'Either'. If
  the 'Either' is a 'Left', it raises 'AssertionFailed' with the message
  from the left side of the either.
-}</span><span>
</span><span id="line-123"></span><span id="local-6989586621679123891"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#assertRight"><span class="hs-identifier hs-type">assertRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679123891"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679123891"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-124"></span><span id="assertRight"><span class="annot"><span class="annottext">assertRight :: Operation (Either String a) a
</span><a href="Orville.PostgreSQL.Plan.Operation.html#assertRight"><span class="hs-identifier hs-var hs-var">assertRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="annottext">Operation :: forall param result.
(forall (m :: * -&gt; *).
 MonadOrville m =&gt;
 param -&gt; m (Either AssertionFailed result))
-&gt; (forall (m :: * -&gt; *).
    MonadOrville m =&gt;
    NonEmpty param -&gt; m (Either AssertionFailed (Many param result)))
-&gt; Explanation
-&gt; Explanation
-&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executeOperationOne :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
Either String a -&gt; m (Either AssertionFailed a)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationOne"><span class="hs-identifier hs-var">executeOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123890"><span class="annot"><span class="annottext">Either String a
</span><a href="#local-6989586621679123890"><span class="hs-identifier hs-var">eitherA</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">Either AssertionFailed a -&gt; m (Either AssertionFailed a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either AssertionFailed a -&gt; m (Either AssertionFailed a))
-&gt; Either AssertionFailed a -&gt; m (Either AssertionFailed a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-128"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either String a
</span><a href="#local-6989586621679123890"><span class="hs-identifier hs-var">eitherA</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679123889"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123889"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>              </span><span class="annot"><span class="annottext">AssertionFailed -&gt; Either AssertionFailed a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; AssertionFailed
</span><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-var">AssertionFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; AssertionFailed) -&gt; String -&gt; AssertionFailed
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Assertion failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123889"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679123888"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679123888"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>              </span><span class="annot"><span class="annottext">a -&gt; Either AssertionFailed a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679123888"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeOperationMany :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
NonEmpty (Either String a)
-&gt; m (Either AssertionFailed (Many (Either String a) a))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationMany"><span class="hs-identifier hs-var">executeOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123887"><span class="annot"><span class="annottext">NonEmpty (Either String a)
</span><a href="#local-6989586621679123887"><span class="hs-identifier hs-var">eitherAs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">Either AssertionFailed (Many (Either String a) a)
-&gt; m (Either AssertionFailed (Many (Either String a) a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either AssertionFailed (Many (Either String a) a)
 -&gt; m (Either AssertionFailed (Many (Either String a) a)))
-&gt; Either AssertionFailed (Many (Either String a) a)
-&gt; m (Either AssertionFailed (Many (Either String a) a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-135"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either String a) -&gt; Either String (NonEmpty a)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either String a)
</span><a href="#local-6989586621679123887"><span class="hs-identifier hs-var">eitherAs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679123885"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123885"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-137"></span><span>              </span><span class="annot"><span class="annottext">AssertionFailed
-&gt; Either AssertionFailed (Many (Either String a) a)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; AssertionFailed
</span><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-var">AssertionFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; AssertionFailed) -&gt; String -&gt; AssertionFailed
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Assertion failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123885"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679123884"><span class="hs-identifier hs-type">errorOnLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679124128"><span class="annot"><a href="#local-6989586621679124128"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679124127"><span class="annot"><a href="#local-6989586621679124127"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679124128"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124127"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html#NotAKey"><span class="hs-identifier hs-type">Many.NotAKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124127"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-140"></span><span>                  </span><span id="local-6989586621679123884"><span class="annot"><span class="annottext">errorOnLeft :: Either a b -&gt; Either NotAKey b
</span><a href="#local-6989586621679123884"><span class="hs-identifier hs-var hs-var">errorOnLeft</span></a></span></span><span> </span><span id="local-6989586621679123883"><span class="annot"><span class="annottext">Either a b
</span><a href="#local-6989586621679123883"><span class="hs-identifier hs-var">eitherA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a b
</span><a href="#local-6989586621679123883"><span class="hs-identifier hs-var">eitherA</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-142"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>                        </span><span class="hs-comment">-- We proved all the values above didn't have any lefts in</span><span>
</span><span id="line-144"></span><span>                        </span><span class="hs-comment">-- then, so if we get a left here it must not be one of the</span><span>
</span><span id="line-145"></span><span>                        </span><span class="hs-comment">-- keys from the Many.</span><span>
</span><span id="line-146"></span><span>                        </span><span class="annot"><span class="annottext">NotAKey -&gt; Either NotAKey b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">NotAKey
</span><a href="Orville.PostgreSQL.Plan.Many.html#NotAKey"><span class="hs-identifier hs-var">Many.NotAKey</span></a></span><span>
</span><span id="line-147"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679123881"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679123881"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>                        </span><span class="annot"><span class="annottext">b -&gt; Either NotAKey b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679123881"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-149"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Many (Either String a) a
-&gt; Either AssertionFailed (Many (Either String a) a)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Many (Either String a) a
 -&gt; Either AssertionFailed (Many (Either String a) a))
-&gt; Many (Either String a) a
-&gt; Either AssertionFailed (Many (Either String a) a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Either String a]
-&gt; (Either String a -&gt; Either NotAKey a)
-&gt; Many (Either String a) a
forall k a. [k] -&gt; (k -&gt; Either NotAKey a) -&gt; Many k a
</span><a href="Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Either String a) -&gt; [Either String a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either String a)
</span><a href="#local-6989586621679123887"><span class="hs-identifier hs-var">eitherAs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either String a -&gt; Either NotAKey a
forall a b. Either a b -&gt; Either NotAKey b
</span><a href="#local-6989586621679123884"><span class="hs-identifier hs-var">errorOnLeft</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationOne :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationOne"><span class="hs-identifier hs-var">explainOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#noExplanation"><span class="hs-identifier hs-var">Exp.noExplanation</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationMany :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationMany"><span class="hs-identifier hs-var">explainOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#noExplanation"><span class="hs-identifier hs-var">Exp.noExplanation</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">{- |
  The functions below ('findOne', 'findAll', etc) accept a 'WherePlanner'
  to determine how to build the where conditions for executing a 'Select'
  statement as part of a the plan operation.

  For simple queries you can use the functions such as 'byField' that are
  provided here to build a 'WherePlanner', but you may also build your own
  custom 'WherePlanner' for more advanced use cases.

  If you need to execute a custom query that cannot be build by providing
  custom where clause via 'WherePlanner', you may want to use more
  direct 'selectOperation' function.
-}</span><span>
</span><span id="line-167"></span><span class="hs-keyword">data</span><span> </span><span id="WherePlanner"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-var">WherePlanner</span></a></span></span><span> </span><span id="local-6989586621679124111"><span class="annot"><a href="#local-6989586621679124111"><span class="hs-identifier hs-type">param</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WherePlanner"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-var">WherePlanner</span></a></span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | The 'paramMarshaller' function provided here will be used to decode</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">-- the parameter field from the result set so that the row can be properly</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- associated with the input parameter that matched it.</span><span>
</span><span id="line-171"></span><span>    </span><span id="paramMarshaller"><span class="annot"><span class="annottext">WherePlanner param
-&gt; forall entity. (entity -&gt; param) -&gt; SqlMarshaller entity param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#paramMarshaller"><span class="hs-identifier hs-var hs-var">paramMarshaller</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679124124"><span class="annot"><a href="#local-6989586621679124124"><span class="hs-identifier hs-type">entity</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679124124"><span class="hs-identifier hs-type">entity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679124111"><span class="hs-identifier hs-type">param</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#SqlMarshaller"><span class="hs-identifier hs-type">SqlMarshaller.SqlMarshaller</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124124"><span class="hs-identifier hs-type">entity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124111"><span class="hs-identifier hs-type">param</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'executeOneWhereCondition' must build a where condition that will</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- match only those rows that match the input paramater.</span><span>
</span><span id="line-174"></span><span>    </span><span id="executeOneWhereCondition"><span class="annot"><span class="annottext">WherePlanner param -&gt; param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOneWhereCondition"><span class="hs-identifier hs-var hs-var">executeOneWhereCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679124111"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'executeManyWhereCondition' must build a where condition that will</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- match only those rows that match any (not all!) of the input parameters.</span><span>
</span><span id="line-177"></span><span>    </span><span id="executeManyWhereCondition"><span class="annot"><span class="annottext">WherePlanner param -&gt; NonEmpty param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeManyWhereCondition"><span class="hs-identifier hs-var hs-var">executeManyWhereCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679124111"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'explainOneWhereCondition' must build a where condition that is</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- suitable to be used as an example of 'executeManyWhereCondition' would</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- return when given a parameter.  This where condition will be used for</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- when producing explanations of plans. For example, this could fill in</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- either an example or dummy value.</span><span>
</span><span id="line-183"></span><span>    </span><span id="explainOneWhereCondition"><span class="annot"><span class="annottext">WherePlanner param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOneWhereCondition"><span class="hs-identifier hs-var hs-var">explainOneWhereCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'explainManyWhereCondition' must build a where condition that is</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- suitable to be used as an example of 'executeOneWhereCondition' would</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- return when given a list of parameters.  This where condition will be</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- used for when producing explanations of plans. For example, this could</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-comment">-- fill in either an example or dummy value.</span><span>
</span><span id="line-189"></span><span>    </span><span id="explainManyWhereCondition"><span class="annot"><span class="annottext">WherePlanner param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainManyWhereCondition"><span class="hs-identifier hs-var hs-var">explainManyWhereCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">{- |
  Builds a 'WherePlanner' that will match on a single
  'FieldDefinition.FieldDefinition'.  The resulting 'WherePlanner' can be used
  with functions such as 'findOne' and 'findAll' to construct an 'Operation'.
-}</span><span>
</span><span id="line-197"></span><span id="local-6989586621679123873"><span id="local-6989586621679123874"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#byField"><span class="hs-identifier hs-type">byField</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.FieldDefinition.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition.FieldDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123874"><span class="hs-identifier hs-type">nullability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123873"><span class="hs-identifier hs-type">fieldValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123873"><span class="hs-identifier hs-type">fieldValue</span></a></span></span></span><span>
</span><span id="line-200"></span><span id="byField"><span class="annot"><span class="annottext">byField :: FieldDefinition nullability fieldValue -&gt; WherePlanner fieldValue
</span><a href="Orville.PostgreSQL.Plan.Operation.html#byField"><span class="hs-identifier hs-var hs-var">byField</span></a></span></span><span> </span><span id="local-6989586621679123872"><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
</span><a href="#local-6989586621679123872"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679123871"><span class="annot"><span class="annottext">stringyField :: FieldDefinition nullability Text
</span><a href="#local-6989586621679123871"><span class="hs-identifier hs-var hs-var">stringyField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
-&gt; FieldDefinition nullability Text
forall nullability a.
FieldDefinition nullability a -&gt; FieldDefinition nullability Text
</span><a href="Orville.PostgreSQL.Plan.Operation.html#stringifyField"><span class="hs-identifier hs-var">stringifyField</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
</span><a href="#local-6989586621679123872"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-203"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WherePlanner :: forall param.
(forall entity. (entity -&gt; param) -&gt; SqlMarshaller entity param)
-&gt; (param -&gt; WhereCondition)
-&gt; (NonEmpty param -&gt; WhereCondition)
-&gt; WhereCondition
-&gt; WhereCondition
-&gt; WherePlanner param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">paramMarshaller :: forall entity.
(entity -&gt; fieldValue) -&gt; SqlMarshaller entity fieldValue
</span><a href="Orville.PostgreSQL.Plan.Operation.html#paramMarshaller"><span class="hs-identifier hs-var">paramMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((entity -&gt; fieldValue)
 -&gt; FieldDefinition nullability fieldValue
 -&gt; SqlMarshaller entity fieldValue)
-&gt; FieldDefinition nullability fieldValue
-&gt; (entity -&gt; fieldValue)
-&gt; SqlMarshaller entity fieldValue
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(entity -&gt; fieldValue)
-&gt; FieldDefinition nullability fieldValue
-&gt; SqlMarshaller entity fieldValue
forall writeEntity fieldValue nullability.
(writeEntity -&gt; fieldValue)
-&gt; FieldDefinition nullability fieldValue
-&gt; SqlMarshaller writeEntity fieldValue
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#marshallField"><span class="hs-identifier hs-var">SqlMarshaller.marshallField</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
</span><a href="#local-6989586621679123872"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeOneWhereCondition :: fieldValue -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOneWhereCondition"><span class="hs-identifier hs-var">executeOneWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123867"><span class="annot"><span class="annottext">fieldValue
</span><a href="#local-6989586621679123867"><span class="hs-identifier hs-var">fieldValue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
-&gt; fieldValue -&gt; WhereCondition
forall nullability a.
FieldDefinition nullability a -&gt; a -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldEquals"><span class="hs-identifier hs-var">SelectOptions.fieldEquals</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
</span><a href="#local-6989586621679123872"><span class="hs-identifier hs-var">fieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">fieldValue
</span><a href="#local-6989586621679123867"><span class="hs-identifier hs-var">fieldValue</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeManyWhereCondition :: NonEmpty fieldValue -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeManyWhereCondition"><span class="hs-identifier hs-var">executeManyWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123865"><span class="annot"><span class="annottext">NonEmpty fieldValue
</span><a href="#local-6989586621679123865"><span class="hs-identifier hs-var">fieldValues</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
-&gt; NonEmpty fieldValue -&gt; WhereCondition
forall nullability a.
FieldDefinition nullability a -&gt; NonEmpty a -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldIn"><span class="hs-identifier hs-var">SelectOptions.fieldIn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability fieldValue
</span><a href="#local-6989586621679123872"><span class="hs-identifier hs-var">fieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty fieldValue
</span><a href="#local-6989586621679123865"><span class="hs-identifier hs-var">fieldValues</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOneWhereCondition :: WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOneWhereCondition"><span class="hs-identifier hs-var">explainOneWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability Text -&gt; Text -&gt; WhereCondition
forall nullability a.
FieldDefinition nullability a -&gt; a -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldEquals"><span class="hs-identifier hs-var">SelectOptions.fieldEquals</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability Text
</span><a href="#local-6989586621679123871"><span class="hs-identifier hs-var">stringyField</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; WhereCondition) -&gt; Text -&gt; WhereCondition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE&quot;</span></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainManyWhereCondition :: WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainManyWhereCondition"><span class="hs-identifier hs-var">explainManyWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability Text -&gt; NonEmpty Text -&gt; WhereCondition
forall nullability a.
FieldDefinition nullability a -&gt; NonEmpty a -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldIn"><span class="hs-identifier hs-var">SelectOptions.fieldIn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullability Text
</span><a href="#local-6989586621679123871"><span class="hs-identifier hs-var">stringyField</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Text -&gt; WhereCondition)
-&gt; NonEmpty Text -&gt; WhereCondition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; NonEmpty String -&gt; NonEmpty Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; NonEmpty String
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE 2&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">{- |
  Builds a 'WherePlanner' that will match on a 2-tuple of
  'FieldDefinition.FieldDefinition's.  The resulting 'WherePlanner' can be used
  with functions such as 'findOne' and 'findAll' to construct an 'Operation'.
-}</span><span>
</span><span id="line-216"></span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#byFieldTuple"><span class="hs-identifier hs-type">byFieldTuple</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679123862"><span class="annot"><a href="#local-6989586621679123862"><span class="hs-identifier hs-type">nullabilityA</span></a></span></span><span> </span><span id="local-6989586621679123861"><span class="annot"><a href="#local-6989586621679123861"><span class="hs-identifier hs-type">fieldValueA</span></a></span></span><span> </span><span id="local-6989586621679123860"><span class="annot"><a href="#local-6989586621679123860"><span class="hs-identifier hs-type">nullabilityB</span></a></span></span><span> </span><span id="local-6989586621679123859"><span class="annot"><a href="#local-6989586621679123859"><span class="hs-identifier hs-type">fieldValueB</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.FieldDefinition.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition.FieldDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123862"><span class="hs-identifier hs-type">nullabilityA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123861"><span class="hs-identifier hs-type">fieldValueA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.FieldDefinition.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition.FieldDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123860"><span class="hs-identifier hs-type">nullabilityB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123859"><span class="hs-identifier hs-type">fieldValueB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679123861"><span class="hs-identifier hs-type">fieldValueA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679123859"><span class="hs-identifier hs-type">fieldValueB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span id="byFieldTuple"><span class="annot"><span class="annottext">byFieldTuple :: FieldDefinition nullabilityA fieldValueA
-&gt; FieldDefinition nullabilityB fieldValueB
-&gt; WherePlanner (fieldValueA, fieldValueB)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#byFieldTuple"><span class="hs-identifier hs-var hs-var">byFieldTuple</span></a></span></span><span> </span><span id="local-6989586621679123858"><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
</span><a href="#local-6989586621679123858"><span class="hs-identifier hs-var">fieldDefA</span></a></span></span><span> </span><span id="local-6989586621679123857"><span class="annot"><span class="annottext">FieldDefinition nullabilityB fieldValueB
</span><a href="#local-6989586621679123857"><span class="hs-identifier hs-var">fieldDefB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679123856"><span class="annot"><span class="annottext">stringyFieldA :: FieldDefinition nullabilityA Text
</span><a href="#local-6989586621679123856"><span class="hs-identifier hs-var hs-var">stringyFieldA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
-&gt; FieldDefinition nullabilityA Text
forall nullability a.
FieldDefinition nullability a -&gt; FieldDefinition nullability Text
</span><a href="Orville.PostgreSQL.Plan.Operation.html#stringifyField"><span class="hs-identifier hs-var">stringifyField</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
</span><a href="#local-6989586621679123858"><span class="hs-identifier hs-var">fieldDefA</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>      </span><span id="local-6989586621679123855"><span class="annot"><span class="annottext">stringyFieldB :: FieldDefinition nullabilityB Text
</span><a href="#local-6989586621679123855"><span class="hs-identifier hs-var hs-var">stringyFieldB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB fieldValueB
-&gt; FieldDefinition nullabilityB Text
forall nullability a.
FieldDefinition nullability a -&gt; FieldDefinition nullability Text
</span><a href="Orville.PostgreSQL.Plan.Operation.html#stringifyField"><span class="hs-identifier hs-var">stringifyField</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB fieldValueB
</span><a href="#local-6989586621679123857"><span class="hs-identifier hs-var">fieldDefB</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>      </span><span id="local-6989586621679123854"><span class="annot"><a href="#local-6989586621679123853"><span class="hs-identifier hs-type">marshaller</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679123854"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679123861"><span class="hs-identifier hs-type">fieldValueA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679123859"><span class="hs-identifier hs-type">fieldValueB</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#SqlMarshaller"><span class="hs-identifier hs-type">SqlMarshaller.SqlMarshaller</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123854"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679123861"><span class="hs-identifier hs-type">fieldValueA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679123859"><span class="hs-identifier hs-type">fieldValueB</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-231"></span><span>      </span><span id="local-6989586621679123853"><span class="annot"><span class="annottext">marshaller :: (a -&gt; (fieldValueA, fieldValueB))
-&gt; SqlMarshaller a (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123853"><span class="hs-identifier hs-var hs-var">marshaller</span></a></span></span><span> </span><span id="local-6989586621679123852"><span class="annot"><span class="annottext">a -&gt; (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123852"><span class="hs-identifier hs-var">accessor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">(fieldValueA -&gt; fieldValueB -&gt; (fieldValueA, fieldValueB))
-&gt; SqlMarshaller a fieldValueA
-&gt; SqlMarshaller a (fieldValueB -&gt; (fieldValueA, fieldValueB))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; fieldValueA)
-&gt; FieldDefinition nullabilityA fieldValueA
-&gt; SqlMarshaller a fieldValueA
forall writeEntity fieldValue nullability.
(writeEntity -&gt; fieldValue)
-&gt; FieldDefinition nullability fieldValue
-&gt; SqlMarshaller writeEntity fieldValue
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#marshallField"><span class="hs-identifier hs-var">SqlMarshaller.marshallField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(fieldValueA, fieldValueB) -&gt; fieldValueA
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((fieldValueA, fieldValueB) -&gt; fieldValueA)
-&gt; (a -&gt; (fieldValueA, fieldValueB)) -&gt; a -&gt; fieldValueA
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123852"><span class="hs-identifier hs-var">accessor</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
</span><a href="#local-6989586621679123858"><span class="hs-identifier hs-var">fieldDefA</span></a></span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="annottext">SqlMarshaller a (fieldValueB -&gt; (fieldValueA, fieldValueB))
-&gt; SqlMarshaller a fieldValueB
-&gt; SqlMarshaller a (fieldValueA, fieldValueB)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; fieldValueB)
-&gt; FieldDefinition nullabilityB fieldValueB
-&gt; SqlMarshaller a fieldValueB
forall writeEntity fieldValue nullability.
(writeEntity -&gt; fieldValue)
-&gt; FieldDefinition nullability fieldValue
-&gt; SqlMarshaller writeEntity fieldValue
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#marshallField"><span class="hs-identifier hs-var">SqlMarshaller.marshallField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(fieldValueA, fieldValueB) -&gt; fieldValueB
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((fieldValueA, fieldValueB) -&gt; fieldValueB)
-&gt; (a -&gt; (fieldValueA, fieldValueB)) -&gt; a -&gt; fieldValueB
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123852"><span class="hs-identifier hs-var">accessor</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB fieldValueB
</span><a href="#local-6989586621679123857"><span class="hs-identifier hs-var">fieldDefB</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>      </span><span id="local-6989586621679123850"><span class="annot"><span class="annottext">packAll :: NonEmpty (String, String) -&gt; NonEmpty (Text, Text)
</span><a href="#local-6989586621679123850"><span class="hs-identifier hs-var hs-var">packAll</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><span class="annottext">((String, String) -&gt; (Text, Text))
-&gt; NonEmpty (String, String) -&gt; NonEmpty (Text, Text)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679123849"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123849"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679123848"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123848"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123849"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679123848"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WherePlanner :: forall param.
(forall entity. (entity -&gt; param) -&gt; SqlMarshaller entity param)
-&gt; (param -&gt; WhereCondition)
-&gt; (NonEmpty param -&gt; WhereCondition)
-&gt; WhereCondition
-&gt; WhereCondition
-&gt; WherePlanner param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">paramMarshaller :: forall entity.
(entity -&gt; (fieldValueA, fieldValueB))
-&gt; SqlMarshaller entity (fieldValueA, fieldValueB)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#paramMarshaller"><span class="hs-identifier hs-var">paramMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall entity.
(entity -&gt; (fieldValueA, fieldValueB))
-&gt; SqlMarshaller entity (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123853"><span class="hs-identifier hs-var">marshaller</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeOneWhereCondition :: (fieldValueA, fieldValueB) -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOneWhereCondition"><span class="hs-identifier hs-var">executeOneWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123847"><span class="annot"><span class="annottext">(fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123847"><span class="hs-identifier hs-var">fieldValue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
-&gt; FieldDefinition nullabilityB fieldValueB
-&gt; NonEmpty (fieldValueA, fieldValueB)
-&gt; WhereCondition
forall nullabilityA a nullabilityB b.
FieldDefinition nullabilityA a
-&gt; FieldDefinition nullabilityB b
-&gt; NonEmpty (a, b)
-&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldTupleIn"><span class="hs-identifier hs-var">SelectOptions.fieldTupleIn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
</span><a href="#local-6989586621679123858"><span class="hs-identifier hs-var">fieldDefA</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB fieldValueB
</span><a href="#local-6989586621679123857"><span class="hs-identifier hs-var">fieldDefB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123847"><span class="hs-identifier hs-var">fieldValue</span></a></span><span> </span><span class="annot"><span class="annottext">(fieldValueA, fieldValueB)
-&gt; [(fieldValueA, fieldValueB)]
-&gt; NonEmpty (fieldValueA, fieldValueB)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeManyWhereCondition :: NonEmpty (fieldValueA, fieldValueB) -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeManyWhereCondition"><span class="hs-identifier hs-var">executeManyWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123845"><span class="annot"><span class="annottext">NonEmpty (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123845"><span class="hs-identifier hs-var">fieldValues</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
-&gt; FieldDefinition nullabilityB fieldValueB
-&gt; NonEmpty (fieldValueA, fieldValueB)
-&gt; WhereCondition
forall nullabilityA a nullabilityB b.
FieldDefinition nullabilityA a
-&gt; FieldDefinition nullabilityB b
-&gt; NonEmpty (a, b)
-&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldTupleIn"><span class="hs-identifier hs-var">SelectOptions.fieldTupleIn</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA fieldValueA
</span><a href="#local-6989586621679123858"><span class="hs-identifier hs-var">fieldDefA</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB fieldValueB
</span><a href="#local-6989586621679123857"><span class="hs-identifier hs-var">fieldDefB</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (fieldValueA, fieldValueB)
</span><a href="#local-6989586621679123845"><span class="hs-identifier hs-var">fieldValues</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOneWhereCondition :: WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOneWhereCondition"><span class="hs-identifier hs-var">explainOneWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA Text
-&gt; FieldDefinition nullabilityB Text
-&gt; NonEmpty (Text, Text)
-&gt; WhereCondition
forall nullabilityA a nullabilityB b.
FieldDefinition nullabilityA a
-&gt; FieldDefinition nullabilityB b
-&gt; NonEmpty (a, b)
-&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldTupleIn"><span class="hs-identifier hs-var">SelectOptions.fieldTupleIn</span></a></span><span>
</span><span id="line-244"></span><span>              </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA Text
</span><a href="#local-6989586621679123856"><span class="hs-identifier hs-var">stringyFieldA</span></a></span><span>
</span><span id="line-245"></span><span>              </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB Text
</span><a href="#local-6989586621679123855"><span class="hs-identifier hs-var">stringyFieldB</span></a></span><span>
</span><span id="line-246"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (String, String) -&gt; NonEmpty (Text, Text)
</span><a href="#local-6989586621679123850"><span class="hs-identifier hs-var">packAll</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (String, String) -&gt; NonEmpty (Text, Text))
-&gt; NonEmpty (String, String) -&gt; NonEmpty (Text, Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE A&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE B&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; [(String, String)] -&gt; NonEmpty (String, String)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainManyWhereCondition :: WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainManyWhereCondition"><span class="hs-identifier hs-var">explainManyWhereCondition</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA Text
-&gt; FieldDefinition nullabilityB Text
-&gt; NonEmpty (Text, Text)
-&gt; WhereCondition
forall nullabilityA a nullabilityB b.
FieldDefinition nullabilityA a
-&gt; FieldDefinition nullabilityB b
-&gt; NonEmpty (a, b)
-&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#fieldTupleIn"><span class="hs-identifier hs-var">SelectOptions.fieldTupleIn</span></a></span><span>
</span><span id="line-249"></span><span>              </span><span class="annot"><span class="annottext">FieldDefinition nullabilityA Text
</span><a href="#local-6989586621679123856"><span class="hs-identifier hs-var">stringyFieldA</span></a></span><span>
</span><span id="line-250"></span><span>              </span><span class="annot"><span class="annottext">FieldDefinition nullabilityB Text
</span><a href="#local-6989586621679123855"><span class="hs-identifier hs-var">stringyFieldB</span></a></span><span>
</span><span id="line-251"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (String, String) -&gt; NonEmpty (Text, Text)
</span><a href="#local-6989586621679123850"><span class="hs-identifier hs-var">packAll</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (String, String) -&gt; NonEmpty (Text, Text))
-&gt; NonEmpty (String, String) -&gt; NonEmpty (Text, Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE A 1&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE B 1&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; [(String, String)] -&gt; NonEmpty (String, String)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE A 2&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXAMPLE VALUE B 2&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">{- |
  'findOne' builds a planning primitive that finds (at most) one row from the
  given table where the column value for the provided 'Core.FieldDefinition' matches
  the plan's input parameter. When executed on multiple parameters it fetches
  all rows where the field matches the inputs and arbitrarily picks at most one
  of those rows to use as the result for each input.
-}</span><span>
</span><span id="line-261"></span><span id="local-6989586621679123841"><span id="local-6989586621679123842"><span id="local-6989586621679123843"><span id="local-6989586621679123844"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findOne"><span class="hs-identifier hs-type">findOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679123844"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition.TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123843"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123842"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123841"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123844"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123844"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679123841"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-266"></span><span id="findOne"><span class="annot"><span class="annottext">findOne :: TableDefinition key writeEntity readEntity
-&gt; WherePlanner param -&gt; Operation param (Maybe readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findOne"><span class="hs-identifier hs-var hs-var">findOne</span></a></span></span><span> </span><span id="local-6989586621679123840"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123840"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679123839"><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123839"><span class="hs-identifier hs-var">wherePlanner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param (Maybe readEntity)
forall param key writeEntity readEntity.
Ord param =&gt;
TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param (Maybe readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWithOpts"><span class="hs-identifier hs-var">findOneWithOpts</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123840"><span class="hs-identifier hs-var">tableDef</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123839"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">{- |
  'findOneWhere' is similar to 'findOne' but allows a 'WhereCondition' to be
  specified that is added to the database query to restrict which rows are
  returned.
-}</span><span>
</span><span id="line-274"></span><span id="local-6989586621679123834"><span id="local-6989586621679123835"><span id="local-6989586621679123836"><span id="local-6989586621679123837"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWhere"><span class="hs-identifier hs-type">findOneWhere</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679123837"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition.TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123836"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123835"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123834"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123837"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123837"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679123834"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-280"></span><span id="findOneWhere"><span class="annot"><span class="annottext">findOneWhere :: TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; WhereCondition
-&gt; Operation param (Maybe readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWhere"><span class="hs-identifier hs-var hs-var">findOneWhere</span></a></span></span><span> </span><span id="local-6989586621679123833"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123833"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679123832"><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123832"><span class="hs-identifier hs-var">wherePlanner</span></a></span></span><span> </span><span id="local-6989586621679123831"><span class="annot"><span class="annottext">WhereCondition
</span><a href="#local-6989586621679123831"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param (Maybe readEntity)
forall param key writeEntity readEntity.
Ord param =&gt;
TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param (Maybe readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWithOpts"><span class="hs-identifier hs-var">findOneWithOpts</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123833"><span class="hs-identifier hs-var">tableDef</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123832"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="annot"><span class="annottext">WhereCondition
</span><a href="#local-6989586621679123831"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">{- |
  'findOneWithOpts' is a internal helper used by 'findOne' and 'findOneWhere'
-}</span><span>
</span><span id="line-286"></span><span id="local-6989586621679124066"><span id="local-6989586621679124067"><span id="local-6989586621679124068"><span id="local-6989586621679124069"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWithOpts"><span class="hs-identifier hs-type">findOneWithOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679124069"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition.TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124068"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124067"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124066"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-289"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124069"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#SelectOptions"><span class="hs-identifier hs-type">SelectOptions.SelectOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124069"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679124066"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-292"></span><span id="findOneWithOpts"><span class="annot"><span class="annottext">findOneWithOpts :: TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param (Maybe readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findOneWithOpts"><span class="hs-identifier hs-var hs-var">findOneWithOpts</span></a></span></span><span> </span><span id="local-6989586621679123829"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123829"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679123828"><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123828"><span class="hs-identifier hs-var">wherePlanner</span></a></span></span><span> </span><span id="local-6989586621679123827"><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123827"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><span class="annottext">SelectOperation param (param, readEntity) (Maybe readEntity)
-&gt; Operation param (Maybe readEntity)
forall param row result.
Ord param =&gt;
SelectOperation param row result -&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOperation"><span class="hs-identifier hs-var">selectOperation</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param (param, readEntity) (Maybe readEntity)
</span><a href="#local-6989586621679123826"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621679123826"><span class="annot"><span class="annottext">selectOp :: SelectOperation param (param, readEntity) (Maybe readEntity)
</span><a href="#local-6989586621679123826"><span class="hs-identifier hs-var hs-var">selectOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">SelectOperation :: forall param row result.
(param -&gt; Select row)
-&gt; (NonEmpty param -&gt; Select row)
-&gt; Select row
-&gt; Select row
-&gt; (row -&gt; param)
-&gt; ([row] -&gt; result)
-&gt; SelectOperation param row result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-type">SelectOperation</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selectOne :: param -&gt; Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOne"><span class="hs-identifier hs-var">selectOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123823"><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123823"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-298"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123822"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123827"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; param -&gt; WhereCondition
forall param. WherePlanner param -&gt; param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOneWhereCondition"><span class="hs-identifier hs-var hs-var">executeOneWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123828"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123823"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#limit"><span class="hs-identifier hs-var">SelectOptions.limit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">selectMany :: NonEmpty param -&gt; Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectMany"><span class="hs-identifier hs-var">selectMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123819"><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123819"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123822"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123827"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; NonEmpty param -&gt; WhereCondition
forall param.
WherePlanner param -&gt; NonEmpty param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeManyWhereCondition"><span class="hs-identifier hs-var hs-var">executeManyWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123828"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123819"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainSelectOne :: Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectOne"><span class="hs-identifier hs-var">explainSelectOne</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123822"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123827"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; WhereCondition
forall param. WherePlanner param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOneWhereCondition"><span class="hs-identifier hs-var hs-var">explainOneWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123828"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainSelectMany :: Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectMany"><span class="hs-identifier hs-var">explainSelectMany</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123822"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123827"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; WhereCondition
forall param. WherePlanner param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainManyWhereCondition"><span class="hs-identifier hs-var hs-var">explainManyWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123828"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">categorizeRow :: (param, readEntity) -&gt; param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#categorizeRow"><span class="hs-identifier hs-var">categorizeRow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(param, readEntity) -&gt; param
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">produceResult :: [(param, readEntity)] -&gt; Maybe readEntity
</span><a href="Orville.PostgreSQL.Plan.Operation.html#produceResult"><span class="hs-identifier hs-var">produceResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((param, readEntity) -&gt; readEntity)
-&gt; Maybe (param, readEntity) -&gt; Maybe readEntity
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(param, readEntity) -&gt; readEntity
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (param, readEntity) -&gt; Maybe readEntity)
-&gt; ([(param, readEntity)] -&gt; Maybe (param, readEntity))
-&gt; [(param, readEntity)]
-&gt; Maybe readEntity
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(param, readEntity)] -&gt; Maybe (param, readEntity)
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">Maybe.listToMaybe</span></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621679123822"><span class="annot"><span class="annottext">select :: SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123822"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
-&gt; Qualified TableName
-&gt; SelectOptions
-&gt; Select (param, readEntity)
forall writeEntity readEntity.
AnnotatedSqlMarshaller writeEntity readEntity
-&gt; Qualified TableName -&gt; SelectOptions -&gt; Select readEntity
</span><a href="Orville.PostgreSQL.Internal.Select.html#selectMarshalledColumns"><span class="hs-identifier hs-var">Select.selectMarshalledColumns</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
</span><a href="#local-6989586621679123812"><span class="hs-identifier hs-var">marshaller</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity -&gt; Qualified TableName
forall key writeEntity readEntity.
TableDefinition key writeEntity readEntity -&gt; Qualified TableName
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableName"><span class="hs-identifier hs-var">TableDefinition.tableName</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123829"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621679123812"><span class="annot"><span class="annottext">marshaller :: AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
</span><a href="#local-6989586621679123812"><span class="hs-identifier hs-var hs-var">marshaller</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><span class="annottext">(SqlMarshaller writeEntity readEntity
 -&gt; SqlMarshaller (param, writeEntity) (param, readEntity))
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
forall readEntityA writeEntityA readEntityB writeEntityB.
(SqlMarshaller readEntityA writeEntityA
 -&gt; SqlMarshaller readEntityB writeEntityB)
-&gt; AnnotatedSqlMarshaller readEntityA writeEntityA
-&gt; AnnotatedSqlMarshaller readEntityB writeEntityB
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#mapSqlMarshaller"><span class="hs-identifier hs-var">SqlMarshaller.mapSqlMarshaller</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123809"><span class="annot"><span class="annottext">SqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679123809"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>              </span><span class="annot"><span class="annottext">(param -&gt; readEntity -&gt; (param, readEntity))
-&gt; SqlMarshaller (param, writeEntity) param
-&gt; SqlMarshaller
     (param, writeEntity) (readEntity -&gt; (param, readEntity))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
-&gt; ((param, writeEntity) -&gt; param)
-&gt; SqlMarshaller (param, writeEntity) param
forall param.
WherePlanner param
-&gt; forall entity. (entity -&gt; param) -&gt; SqlMarshaller entity param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#paramMarshaller"><span class="hs-identifier hs-var hs-var">paramMarshaller</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123828"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">(param, writeEntity) -&gt; param
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-319"></span><span>              </span><span class="annot"><span class="annottext">SqlMarshaller
  (param, writeEntity) (readEntity -&gt; (param, readEntity))
-&gt; SqlMarshaller (param, writeEntity) readEntity
-&gt; SqlMarshaller (param, writeEntity) (param, readEntity)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">((param, writeEntity) -&gt; writeEntity)
-&gt; SqlMarshaller writeEntity readEntity
-&gt; SqlMarshaller (param, writeEntity) readEntity
forall parentEntity nestedWriteEntity nestedReadEntity.
(parentEntity -&gt; nestedWriteEntity)
-&gt; SqlMarshaller nestedWriteEntity nestedReadEntity
-&gt; SqlMarshaller parentEntity nestedReadEntity
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#marshallNested"><span class="hs-identifier hs-var">SqlMarshaller.marshallNested</span></a></span><span> </span><span class="annot"><span class="annottext">(param, writeEntity) -&gt; writeEntity
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">SqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679123809"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
forall key writeEntity readEntity.
TableDefinition key writeEntity readEntity
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableMarshaller"><span class="hs-identifier hs-var">TableDefinition.tableMarshaller</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123829"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">{- |
  'findAll' builds a planning primitive that finds all the rows from the
  given table where the column value for the provided field matches the
  plan's input parameter. Where executed on multiple parameters all rows
  are fetch in a single query and then associated with their respective
  inputs after being fetched.
-}</span><span>
</span><span id="line-330"></span><span id="local-6989586621679123803"><span id="local-6989586621679123804"><span id="local-6989586621679123805"><span id="local-6989586621679123806"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findAll"><span class="hs-identifier hs-type">findAll</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679123806"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition.TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123805"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123804"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123803"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123806"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123806"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679123803"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-335"></span><span id="findAll"><span class="annot"><span class="annottext">findAll :: TableDefinition key writeEntity readEntity
-&gt; WherePlanner param -&gt; Operation param [readEntity]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findAll"><span class="hs-identifier hs-var hs-var">findAll</span></a></span></span><span> </span><span id="local-6989586621679123802"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123802"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679123801"><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123801"><span class="hs-identifier hs-var">wherePlanner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param [readEntity]
forall param key writeEntity readEntity.
Ord param =&gt;
TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param [readEntity]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWithOpts"><span class="hs-identifier hs-var">findAllWithOpts</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123802"><span class="hs-identifier hs-var">tableDef</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123801"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-comment">{- |
  'findAllWhere' is similar to 'findAll' but allows a 'WhereCondition' to be
  specified that is added to the database query to restrict which rows are
  returned.
-}</span><span>
</span><span id="line-343"></span><span id="local-6989586621679123796"><span id="local-6989586621679123797"><span id="local-6989586621679123798"><span id="local-6989586621679123799"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWhere"><span class="hs-identifier hs-type">findAllWhere</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679123799"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition.TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123798"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123797"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123796"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123799"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123799"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679123796"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-349"></span><span id="findAllWhere"><span class="annot"><span class="annottext">findAllWhere :: TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; WhereCondition
-&gt; Operation param [readEntity]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWhere"><span class="hs-identifier hs-var hs-var">findAllWhere</span></a></span></span><span> </span><span id="local-6989586621679123795"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123795"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679123794"><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123794"><span class="hs-identifier hs-var">wherePlanner</span></a></span></span><span> </span><span id="local-6989586621679123793"><span class="annot"><span class="annottext">WhereCondition
</span><a href="#local-6989586621679123793"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param [readEntity]
forall param key writeEntity readEntity.
Ord param =&gt;
TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param [readEntity]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWithOpts"><span class="hs-identifier hs-var">findAllWithOpts</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123795"><span class="hs-identifier hs-var">tableDef</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123794"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="annot"><span class="annottext">WhereCondition
</span><a href="#local-6989586621679123793"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">{- |
  'findAllWithOpts' is an internal helper used by 'findAll' and 'findAllWhere'
-}</span><span>
</span><span id="line-355"></span><span id="local-6989586621679124022"><span id="local-6989586621679124023"><span id="local-6989586621679124024"><span id="local-6989586621679124025"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWithOpts"><span class="hs-identifier hs-type">findAllWithOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679124025"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition.TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124024"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124023"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124022"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#WherePlanner"><span class="hs-identifier hs-type">WherePlanner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124025"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#SelectOptions"><span class="hs-identifier hs-type">SelectOptions.SelectOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124025"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679124022"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-361"></span><span id="findAllWithOpts"><span class="annot"><span class="annottext">findAllWithOpts :: TableDefinition key writeEntity readEntity
-&gt; WherePlanner param
-&gt; SelectOptions
-&gt; Operation param [readEntity]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findAllWithOpts"><span class="hs-identifier hs-var hs-var">findAllWithOpts</span></a></span></span><span> </span><span id="local-6989586621679123792"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123792"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679123791"><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123791"><span class="hs-identifier hs-var">wherePlanner</span></a></span></span><span> </span><span id="local-6989586621679123790"><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123790"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>  </span><span class="annot"><span class="annottext">SelectOperation param (param, readEntity) [readEntity]
-&gt; Operation param [readEntity]
forall param row result.
Ord param =&gt;
SelectOperation param row result -&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOperation"><span class="hs-identifier hs-var">selectOperation</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param (param, readEntity) [readEntity]
</span><a href="#local-6989586621679123789"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621679123789"><span class="annot"><span class="annottext">selectOp :: SelectOperation param (param, readEntity) [readEntity]
</span><a href="#local-6989586621679123789"><span class="hs-identifier hs-var hs-var">selectOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">SelectOperation :: forall param row result.
(param -&gt; Select row)
-&gt; (NonEmpty param -&gt; Select row)
-&gt; Select row
-&gt; Select row
-&gt; (row -&gt; param)
-&gt; ([row] -&gt; result)
-&gt; SelectOperation param row result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-type">SelectOperation</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selectOne :: param -&gt; Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOne"><span class="hs-identifier hs-var">selectOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123788"><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123788"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123787"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123790"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; param -&gt; WhereCondition
forall param. WherePlanner param -&gt; param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOneWhereCondition"><span class="hs-identifier hs-var hs-var">executeOneWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123791"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123788"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">selectMany :: NonEmpty param -&gt; Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectMany"><span class="hs-identifier hs-var">selectMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123786"><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123786"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-369"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123787"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123790"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; NonEmpty param -&gt; WhereCondition
forall param.
WherePlanner param -&gt; NonEmpty param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeManyWhereCondition"><span class="hs-identifier hs-var hs-var">executeManyWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123791"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123786"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainSelectOne :: Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectOne"><span class="hs-identifier hs-var">explainSelectOne</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-371"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123787"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123790"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; WhereCondition
forall param. WherePlanner param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOneWhereCondition"><span class="hs-identifier hs-var hs-var">explainOneWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123791"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainSelectMany :: Select (param, readEntity)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectMany"><span class="hs-identifier hs-var">explainSelectMany</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><span class="annottext">SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123787"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOptions
</span><a href="#local-6989586621679123790"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOptions -&gt; SelectOptions -&gt; SelectOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; SelectOptions
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.SelectOptions.html#where_"><span class="hs-identifier hs-var">SelectOptions.where_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WherePlanner param -&gt; WhereCondition
forall param. WherePlanner param -&gt; WhereCondition
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainManyWhereCondition"><span class="hs-identifier hs-var hs-var">explainManyWhereCondition</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123791"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">categorizeRow :: (param, readEntity) -&gt; param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#categorizeRow"><span class="hs-identifier hs-var">categorizeRow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(param, readEntity) -&gt; param
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">produceResult :: [(param, readEntity)] -&gt; [readEntity]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#produceResult"><span class="hs-identifier hs-var">produceResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((param, readEntity) -&gt; readEntity)
-&gt; [(param, readEntity)] -&gt; [readEntity]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(param, readEntity) -&gt; readEntity
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621679123787"><span class="annot"><span class="annottext">select :: SelectOptions -&gt; Select (param, readEntity)
</span><a href="#local-6989586621679123787"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
-&gt; Qualified TableName
-&gt; SelectOptions
-&gt; Select (param, readEntity)
forall writeEntity readEntity.
AnnotatedSqlMarshaller writeEntity readEntity
-&gt; Qualified TableName -&gt; SelectOptions -&gt; Select readEntity
</span><a href="Orville.PostgreSQL.Internal.Select.html#selectMarshalledColumns"><span class="hs-identifier hs-var">Select.selectMarshalledColumns</span></a></span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
</span><a href="#local-6989586621679123785"><span class="hs-identifier hs-var">marshaller</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity -&gt; Qualified TableName
forall key writeEntity readEntity.
TableDefinition key writeEntity readEntity -&gt; Qualified TableName
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableName"><span class="hs-identifier hs-var">TableDefinition.tableName</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123792"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621679123785"><span class="annot"><span class="annottext">marshaller :: AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
</span><a href="#local-6989586621679123785"><span class="hs-identifier hs-var hs-var">marshaller</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><span class="annottext">(SqlMarshaller writeEntity readEntity
 -&gt; SqlMarshaller (param, writeEntity) (param, readEntity))
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; AnnotatedSqlMarshaller (param, writeEntity) (param, readEntity)
forall readEntityA writeEntityA readEntityB writeEntityB.
(SqlMarshaller readEntityA writeEntityA
 -&gt; SqlMarshaller readEntityB writeEntityB)
-&gt; AnnotatedSqlMarshaller readEntityA writeEntityA
-&gt; AnnotatedSqlMarshaller readEntityB writeEntityB
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#mapSqlMarshaller"><span class="hs-identifier hs-var">SqlMarshaller.mapSqlMarshaller</span></a></span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123784"><span class="annot"><span class="annottext">SqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679123784"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>              </span><span class="annot"><span class="annottext">(param -&gt; readEntity -&gt; (param, readEntity))
-&gt; SqlMarshaller (param, writeEntity) param
-&gt; SqlMarshaller
     (param, writeEntity) (readEntity -&gt; (param, readEntity))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
-&gt; ((param, writeEntity) -&gt; param)
-&gt; SqlMarshaller (param, writeEntity) param
forall param.
WherePlanner param
-&gt; forall entity. (entity -&gt; param) -&gt; SqlMarshaller entity param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#paramMarshaller"><span class="hs-identifier hs-var hs-var">paramMarshaller</span></a></span><span> </span><span class="annot"><span class="annottext">WherePlanner param
</span><a href="#local-6989586621679123791"><span class="hs-identifier hs-var">wherePlanner</span></a></span><span> </span><span class="annot"><span class="annottext">(param, writeEntity) -&gt; param
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-388"></span><span>              </span><span class="annot"><span class="annottext">SqlMarshaller
  (param, writeEntity) (readEntity -&gt; (param, readEntity))
-&gt; SqlMarshaller (param, writeEntity) readEntity
-&gt; SqlMarshaller (param, writeEntity) (param, readEntity)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">((param, writeEntity) -&gt; writeEntity)
-&gt; SqlMarshaller writeEntity readEntity
-&gt; SqlMarshaller (param, writeEntity) readEntity
forall parentEntity nestedWriteEntity nestedReadEntity.
(parentEntity -&gt; nestedWriteEntity)
-&gt; SqlMarshaller nestedWriteEntity nestedReadEntity
-&gt; SqlMarshaller parentEntity nestedReadEntity
</span><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#marshallNested"><span class="hs-identifier hs-var">SqlMarshaller.marshallNested</span></a></span><span> </span><span class="annot"><span class="annottext">(param, writeEntity) -&gt; writeEntity
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">SqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679123784"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
forall key writeEntity readEntity.
TableDefinition key writeEntity readEntity
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableMarshaller"><span class="hs-identifier hs-var">TableDefinition.tableMarshaller</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679123792"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-comment">{- |
  'stringifyField' arbitrarily re-labels the 'SqlType' of a field definition
  as text. It is an internal helper function that is used for constructing
  'WhereCondition' clauses used to generate sql when explaining how a plan
  will be executed. Relabeling the type as 'T.Text' allows us to use text
  values as example inputs in the queries when for explaining plans.
-}</span><span>
</span><span id="line-399"></span><span id="local-6989586621679124112"><span id="local-6989586621679124113"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#stringifyField"><span class="hs-identifier hs-type">stringifyField</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.FieldDefinition.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition.FieldDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124113"><span class="hs-identifier hs-type">nullability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124112"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.FieldDefinition.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition.FieldDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124113"><span class="hs-identifier hs-type">nullability</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span></span><span>
</span><span id="line-402"></span><span id="stringifyField"><span class="annot"><span class="annottext">stringifyField :: FieldDefinition nullability a -&gt; FieldDefinition nullability Text
</span><a href="Orville.PostgreSQL.Plan.Operation.html#stringifyField"><span class="hs-identifier hs-var hs-var">stringifyField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="annottext">(SqlType a -&gt; SqlType Text)
-&gt; FieldDefinition nullability a
-&gt; FieldDefinition nullability Text
forall a b nullability.
(SqlType a -&gt; SqlType b)
-&gt; FieldDefinition nullability a -&gt; FieldDefinition nullability b
</span><a href="Orville.PostgreSQL.Internal.FieldDefinition.html#convertField"><span class="hs-identifier hs-var">FieldDefinition.convertField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlType Text -&gt; SqlType a -&gt; SqlType Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">SqlType Text
</span><a href="Orville.PostgreSQL.Internal.SqlType.html#unboundedText"><span class="hs-identifier hs-var">SqlType.unboundedText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">{- |
  'SelectOperation' is a helper type for building 'Operation' primitives that
  run 'Select' queries. Specifying the fields of 'SelectOperation' and then
  using the 'selectOperation' function to build an 'Operation' is more
  convenient that building functions to execute the queries thate are required
  by the 'Operation' type.

  Note: If you only need to build a custom where clause based on the
  'Operation' parameter, you may want to use a custom 'WherePlanner' with one
  of the existing 'findOne' or 'findAll' functions.

  If you cannot respresent your custom operation using 'SelectOperation' then
  you need build the 'Operation' value directly yourself.
-}</span><span>
</span><span id="line-419"></span><span class="hs-keyword">data</span><span> </span><span id="SelectOperation"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-var">SelectOperation</span></a></span></span><span> </span><span id="local-6989586621679124052"><span class="annot"><a href="#local-6989586621679124052"><span class="hs-identifier hs-type">param</span></a></span></span><span> </span><span id="local-6989586621679124051"><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span></span><span> </span><span id="local-6989586621679124049"><span class="annot"><a href="#local-6989586621679124049"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SelectOperation"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-var">SelectOperation</span></a></span></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | 'selectOne' will be called to build the 'Select' query that should</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- be run when there is a single input parameter while executing a plan.</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- Note that the &quot;One-ness&quot; here refers to the single input parameter</span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-comment">-- rather than result. See 'produceResult' below for more information</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- about returning one values vs. many from a 'SelectOperation'.</span><span>
</span><span id="line-425"></span><span>    </span><span id="selectOne"><span class="annot"><span class="annottext">SelectOperation param row result -&gt; param -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOne"><span class="hs-identifier hs-var hs-var">selectOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679124052"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'selectMany' will be called to build the 'Select' query that should</span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-comment">-- be run when there are multiple parameters while executing a plan.</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-comment">-- Note that the &quot;Many-ness&quot; here refers to the multiple input parameters</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-comment">-- rather than result. See 'produceResult' below for more information</span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-comment">-- about returning one values vs. many from a 'SelectOperation'.</span><span>
</span><span id="line-431"></span><span>    </span><span id="selectMany"><span class="annot"><span class="annottext">SelectOperation param row result -&gt; NonEmpty param -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectMany"><span class="hs-identifier hs-var hs-var">selectMany</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679124052"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'explainSelectOne' should show a representative query of what will</span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-comment">-- be returned when 'selectOne' is used. No input parameter is available</span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-comment">-- here to build the query, however, because this value is used to</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-comment">-- explain a plan without actually running it.</span><span>
</span><span id="line-436"></span><span>    </span><span id="explainSelectOne"><span class="annot"><span class="annottext">SelectOperation param row result -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectOne"><span class="hs-identifier hs-var hs-var">explainSelectOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'explainSelectMany' should show a representative query of what will</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- be returned when 'selectMany is used. No input parameters are available</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- here to build the query, however, because this value is used to</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-comment">-- explain a plan without actually running it.</span><span>
</span><span id="line-441"></span><span>    </span><span id="explainSelectMany"><span class="annot"><span class="annottext">SelectOperation param row result -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectMany"><span class="hs-identifier hs-var hs-var">explainSelectMany</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'categorizeRow' will be used when a plan is executed with multiple</span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-comment">-- parameters to determine which input parameter the row should be</span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-comment">-- associated with.</span><span>
</span><span id="line-445"></span><span>    </span><span id="categorizeRow"><span class="annot"><span class="annottext">SelectOperation param row result -&gt; row -&gt; param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#categorizeRow"><span class="hs-identifier hs-var hs-var">categorizeRow</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679124052"><span class="hs-identifier hs-type">param</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | 'produceResult' will be used convert the 'row' type returned by the</span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-comment">-- 'Select' queries for the operation input the 'result' type that is</span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-comment">-- present as the output of the operation. The input rows will be all the</span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-comment">-- inputs associated with a single parameter. The 'result' type</span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-comment">-- constructed here need not be a single value. For instance, 'findAll'</span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-comment">-- uses the list type as the 'result' type and 'findOne' uses 'Maybe'.</span><span>
</span><span id="line-452"></span><span>    </span><span id="produceResult"><span class="annot"><span class="annottext">SelectOperation param row result -&gt; [row] -&gt; result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#produceResult"><span class="hs-identifier hs-var hs-var">produceResult</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679124051"><span class="hs-identifier hs-type">row</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679124049"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">{- |
  'selectOperation' builds a primitive planning 'Operation' using the functions
  given by a 'SelectOperation'. If you are implementing a custom operation that
  runs a select statement, it is probably easier to use this function rather
  than building the 'Operation' functions directly.
-}</span><span>
</span><span id="line-461"></span><span id="local-6989586621679124053"><span id="local-6989586621679124054"><span id="local-6989586621679124055"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#selectOperation"><span class="hs-identifier hs-type">selectOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679124055"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-type">SelectOperation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124055"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124054"><span class="hs-identifier hs-type">row</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124053"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124055"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679124053"><span class="hs-identifier hs-type">result</span></a></span></span></span></span><span>
</span><span id="line-465"></span><span id="selectOperation"><span class="annot"><span class="annottext">selectOperation :: SelectOperation param row result -&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOperation"><span class="hs-identifier hs-var hs-var">selectOperation</span></a></span></span><span> </span><span id="local-6989586621679123780"><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123780"><span class="hs-identifier hs-var">selectOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>  </span><span class="annot"><span class="annottext">Operation :: forall param result.
(forall (m :: * -&gt; *).
 MonadOrville m =&gt;
 param -&gt; m (Either AssertionFailed result))
-&gt; (forall (m :: * -&gt; *).
    MonadOrville m =&gt;
    NonEmpty param -&gt; m (Either AssertionFailed (Many param result)))
-&gt; Explanation
-&gt; Explanation
-&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executeOperationOne :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
param -&gt; m (Either AssertionFailed result)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationOne"><span class="hs-identifier hs-var">executeOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
-&gt; param -&gt; m (Either AssertionFailed result)
forall (m :: * -&gt; *) param row result.
MonadOrville m =&gt;
SelectOperation param row result
-&gt; param -&gt; m (Either AssertionFailed result)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeSelectOne"><span class="hs-identifier hs-var">executeSelectOne</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123780"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeOperationMany :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
NonEmpty param -&gt; m (Either AssertionFailed (Many param result))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationMany"><span class="hs-identifier hs-var">executeOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
-&gt; NonEmpty param -&gt; m (Either AssertionFailed (Many param result))
forall param row result (m :: * -&gt; *).
(Ord param, MonadOrville m) =&gt;
SelectOperation param row result
-&gt; NonEmpty param -&gt; m (Either AssertionFailed (Many param result))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeSelectMany"><span class="hs-identifier hs-var">executeSelectMany</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123780"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationOne :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationOne"><span class="hs-identifier hs-var">explainOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Select row -&gt; Explanation
forall row. Select row -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelect"><span class="hs-identifier hs-var">explainSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select row -&gt; Explanation) -&gt; Select row -&gt; Explanation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; Select row
forall param row result.
SelectOperation param row result -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectOne"><span class="hs-identifier hs-var hs-var">explainSelectOne</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123780"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationMany :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationMany"><span class="hs-identifier hs-var">explainOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Select row -&gt; Explanation
forall row. Select row -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelect"><span class="hs-identifier hs-var">explainSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select row -&gt; Explanation) -&gt; Select row -&gt; Explanation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; Select row
forall param row result.
SelectOperation param row result -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelectMany"><span class="hs-identifier hs-var hs-var">explainSelectMany</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123780"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span id="local-6989586621679123972"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelect"><span class="hs-identifier hs-type">explainSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123972"><span class="hs-identifier hs-type">row</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Explanation.html#Explanation"><span class="hs-identifier hs-type">Exp.Explanation</span></a></span></span><span>
</span><span id="line-474"></span><span id="explainSelect"><span class="annot"><span class="annottext">explainSelect :: Select row -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainSelect"><span class="hs-identifier hs-var hs-var">explainSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#explainStep"><span class="hs-identifier hs-var">Exp.explainStep</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Explanation)
-&gt; (Select row -&gt; String) -&gt; Select row -&gt; Explanation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">BS8.unpack</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; String)
-&gt; (Select row -&gt; ByteString) -&gt; Select row -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QueryExpr -&gt; ByteString
forall sql. SqlExpression sql =&gt; sql -&gt; ByteString
</span><a href="Orville.PostgreSQL.Internal.RawSql.html#toExampleBytes"><span class="hs-identifier hs-var">RawSql.toExampleBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(QueryExpr -&gt; ByteString)
-&gt; (Select row -&gt; QueryExpr) -&gt; Select row -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Select row -&gt; QueryExpr
forall readEntity. Select readEntity -&gt; QueryExpr
</span><a href="Orville.PostgreSQL.Internal.Select.html#selectToQueryExpr"><span class="hs-identifier hs-var">Select.selectToQueryExpr</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">{- |
  'runSelectOne' is an internal helper function that executes a
  'SelectOperation' on a single input parameter.
-}</span><span>
</span><span id="line-481"></span><span id="local-6989586621679123978"><span id="local-6989586621679123979"><span id="local-6989586621679123980"><span id="local-6989586621679123981"><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#executeSelectOne"><span class="hs-identifier hs-type">executeSelectOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-482"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123981"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-type">SelectOperation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123980"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123979"><span class="hs-identifier hs-type">row</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123978"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-484"></span><span>  </span><span class="annot"><a href="#local-6989586621679123980"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><a href="#local-6989586621679123981"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">AssertionFailed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123978"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-486"></span><span id="executeSelectOne"><span class="annot"><span class="annottext">executeSelectOne :: SelectOperation param row result
-&gt; param -&gt; m (Either AssertionFailed result)
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeSelectOne"><span class="hs-identifier hs-var hs-var">executeSelectOne</span></a></span></span><span> </span><span id="local-6989586621679123772"><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123772"><span class="hs-identifier hs-var">selectOp</span></a></span></span><span> </span><span id="local-6989586621679123771"><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123771"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-487"></span><span>  </span><span class="annot"><span class="annottext">result -&gt; Either AssertionFailed result
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(result -&gt; Either AssertionFailed result)
-&gt; ([row] -&gt; result) -&gt; [row] -&gt; Either AssertionFailed result
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; [row] -&gt; result
forall param row result.
SelectOperation param row result -&gt; [row] -&gt; result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#produceResult"><span class="hs-identifier hs-var hs-var">produceResult</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123772"><span class="hs-identifier hs-var">selectOp</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><span class="annottext">([row] -&gt; Either AssertionFailed result)
-&gt; m [row] -&gt; m (Either AssertionFailed result)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select row -&gt; m [row]
forall (m :: * -&gt; *) row. MonadOrville m =&gt; Select row -&gt; m [row]
</span><a href="Orville.PostgreSQL.Internal.Select.html#executeSelect"><span class="hs-identifier hs-var">Select.executeSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select row -&gt; m [row])
-&gt; (param -&gt; Select row) -&gt; param -&gt; m [row]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; param -&gt; Select row
forall param row result.
SelectOperation param row result -&gt; param -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectOne"><span class="hs-identifier hs-var hs-var">selectOne</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123772"><span class="hs-identifier hs-var">selectOp</span></a></span><span> </span><span class="annot"><span class="annottext">(param -&gt; m [row]) -&gt; param -&gt; m [row]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123771"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-comment">{- |
  'executeSelectMany' is an internal helper function that executes a
  'SelectOperation' on multiple input parameters.
-}</span><span>
</span><span id="line-494"></span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#executeSelectMany"><span class="hs-identifier hs-type">executeSelectMany</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679123976"><span class="annot"><a href="#local-6989586621679123976"><span class="hs-identifier hs-type">param</span></a></span></span><span> </span><span id="local-6989586621679123974"><span class="annot"><a href="#local-6989586621679123974"><span class="hs-identifier hs-type">row</span></a></span></span><span> </span><span id="local-6989586621679123973"><span class="annot"><a href="#local-6989586621679123973"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span id="local-6989586621679123975"><span class="annot"><a href="#local-6989586621679123975"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679123976"><span class="hs-identifier hs-type">param</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123975"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#SelectOperation"><span class="hs-identifier hs-type">SelectOperation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123976"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123974"><span class="hs-identifier hs-type">row</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123973"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679123976"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>  </span><span class="annot"><a href="#local-6989586621679123975"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#AssertionFailed"><span class="hs-identifier hs-type">AssertionFailed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123976"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123973"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span id="executeSelectMany"><span class="annot"><span class="annottext">executeSelectMany :: SelectOperation param row result
-&gt; NonEmpty param -&gt; m (Either AssertionFailed (Many param result))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeSelectMany"><span class="hs-identifier hs-var hs-var">executeSelectMany</span></a></span></span><span> </span><span id="local-6989586621679123769"><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123769"><span class="hs-identifier hs-var">selectOp</span></a></span></span><span> </span><span id="local-6989586621679123768"><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123768"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621679123767"><span class="annot"><span class="annottext">[row]
</span><a href="#local-6989586621679123767"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Select row -&gt; m [row]
forall (m :: * -&gt; *) row. MonadOrville m =&gt; Select row -&gt; m [row]
</span><a href="Orville.PostgreSQL.Internal.Select.html#executeSelect"><span class="hs-identifier hs-var">Select.executeSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select row -&gt; m [row])
-&gt; (NonEmpty param -&gt; Select row) -&gt; NonEmpty param -&gt; m [row]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; NonEmpty param -&gt; Select row
forall param row result.
SelectOperation param row result -&gt; NonEmpty param -&gt; Select row
</span><a href="Orville.PostgreSQL.Plan.Operation.html#selectMany"><span class="hs-identifier hs-var hs-var">selectMany</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123769"><span class="hs-identifier hs-var">selectOp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty param -&gt; m [row]) -&gt; NonEmpty param -&gt; m [row]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123768"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Seed add initial map with an empty list for every input parameter</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-comment">-- to guarantee that each param is a key in the map even if no rows</span><span>
</span><span id="line-505"></span><span>      </span><span class="hs-comment">-- where returned from the select query for that param.</span><span>
</span><span id="line-506"></span><span>      </span><span id="local-6989586621679123946"><span class="annot"><a href="#local-6989586621679123766"><span class="hs-identifier hs-type">emptyRowsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679123976"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679123946"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-507"></span><span>      </span><span id="local-6989586621679123766"><span class="annot"><span class="annottext">emptyRowsMap :: Map param [a]
</span><a href="#local-6989586621679123766"><span class="hs-identifier hs-var hs-var">emptyRowsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="annottext">[(param, [a])] -&gt; Map param [a]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-509"></span><span>          </span><span class="annot"><span class="annottext">([(param, [a])] -&gt; Map param [a])
-&gt; (NonEmpty param -&gt; [(param, [a])])
-&gt; NonEmpty param
-&gt; Map param [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(param -&gt; (param, [a])) -&gt; [param] -&gt; [(param, [a])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679123764"><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123764"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123764"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>          </span><span class="annot"><span class="annottext">([param] -&gt; [(param, [a])])
-&gt; (NonEmpty param -&gt; [param]) -&gt; NonEmpty param -&gt; [(param, [a])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty param -&gt; [param]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span>
</span><span id="line-511"></span><span>          </span><span class="annot"><span class="annottext">(NonEmpty param -&gt; Map param [a])
-&gt; NonEmpty param -&gt; Map param [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123768"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>      </span><span id="local-6989586621679123763"><span class="annot"><span class="annottext">insertRow :: Map param [row] -&gt; row -&gt; Map param [row]
</span><a href="#local-6989586621679123763"><span class="hs-identifier hs-var hs-var">insertRow</span></a></span></span><span> </span><span id="local-6989586621679123762"><span class="annot"><span class="annottext">Map param [row]
</span><a href="#local-6989586621679123762"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span id="local-6989586621679123761"><span class="annot"><span class="annottext">row
</span><a href="#local-6989586621679123761"><span class="hs-identifier hs-var">row</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><span class="annottext">(Maybe [row] -&gt; Maybe [row])
-&gt; param -&gt; Map param [row] -&gt; Map param [row]
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.alter</span></span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679123759"><span class="annot"><span class="annottext">Maybe [row]
</span><a href="#local-6989586621679123759"><span class="hs-identifier hs-var">mbRows</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[row] -&gt; Maybe [row]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">row
</span><a href="#local-6989586621679123761"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="annot"><span class="annottext">row -&gt; [row] -&gt; [row]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[row] -&gt; Maybe [row] -&gt; [row]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">Maybe.fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [row]
</span><a href="#local-6989586621679123759"><span class="hs-identifier hs-var">mbRows</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; row -&gt; param
forall param row result.
SelectOperation param row result -&gt; row -&gt; param
</span><a href="Orville.PostgreSQL.Plan.Operation.html#categorizeRow"><span class="hs-identifier hs-var hs-var">categorizeRow</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123769"><span class="hs-identifier hs-var">selectOp</span></a></span><span> </span><span class="annot"><span class="annottext">row
</span><a href="#local-6989586621679123761"><span class="hs-identifier hs-var">row</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>          </span><span class="annot"><span class="annottext">Map param [row]
</span><a href="#local-6989586621679123762"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>      </span><span id="local-6989586621679123757"><span class="annot"><span class="annottext">rowMap :: Map param result
</span><a href="#local-6989586621679123757"><span class="hs-identifier hs-var hs-var">rowMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-520"></span><span>        </span><span class="annot"><span class="annottext">SelectOperation param row result -&gt; [row] -&gt; result
forall param row result.
SelectOperation param row result -&gt; [row] -&gt; result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#produceResult"><span class="hs-identifier hs-var hs-var">produceResult</span></a></span><span> </span><span class="annot"><span class="annottext">SelectOperation param row result
</span><a href="#local-6989586621679123769"><span class="hs-identifier hs-var">selectOp</span></a></span><span> </span><span class="annot"><span class="annottext">([row] -&gt; result) -&gt; Map param [row] -&gt; Map param result
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Map param [row] -&gt; row -&gt; Map param [row])
-&gt; Map param [row] -&gt; [row] -&gt; Map param [row]
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">Fold.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map param [row] -&gt; row -&gt; Map param [row]
</span><a href="#local-6989586621679123763"><span class="hs-identifier hs-var">insertRow</span></a></span><span> </span><span class="annot"><span class="annottext">Map param [row]
forall a. Map param [a]
</span><a href="#local-6989586621679123766"><span class="hs-identifier hs-var">emptyRowsMap</span></a></span><span> </span><span class="annot"><span class="annottext">[row]
</span><a href="#local-6989586621679123767"><span class="hs-identifier hs-var">rows</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>      </span><span id="local-6989586621679123755"><span class="annot"><span class="annottext">manyRows :: Many param result
</span><a href="#local-6989586621679123755"><span class="hs-identifier hs-var hs-var">manyRows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-523"></span><span>        </span><span class="annot"><span class="annottext">[param] -&gt; (param -&gt; Either NotAKey result) -&gt; Many param result
forall k a. [k] -&gt; (k -&gt; Either NotAKey a) -&gt; Many k a
</span><a href="Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty param -&gt; [param]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123768"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((param -&gt; Either NotAKey result) -&gt; Many param result)
-&gt; (param -&gt; Either NotAKey result) -&gt; Many param result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679123754"><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123754"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-524"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">param -&gt; Map param result -&gt; Maybe result
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">param
</span><a href="#local-6989586621679123754"><span class="hs-identifier hs-var">param</span></a></span><span> </span><span class="annot"><span class="annottext">Map param result
</span><a href="#local-6989586621679123757"><span class="hs-identifier hs-var">rowMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>            </span><span class="annot"><span class="annottext">Maybe result
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-526"></span><span>              </span><span class="hs-comment">-- Because we seeded the map above with all the input parameters we</span><span>
</span><span id="line-527"></span><span>              </span><span class="hs-comment">-- can be sure that if we don't find a value in the map here it is</span><span>
</span><span id="line-528"></span><span>              </span><span class="hs-comment">-- because the function parameter is not one of the original inputs</span><span>
</span><span id="line-529"></span><span>              </span><span class="hs-comment">-- rather than just an input for which no rows were returned by the</span><span>
</span><span id="line-530"></span><span>              </span><span class="hs-comment">-- select query.</span><span>
</span><span id="line-531"></span><span>              </span><span class="annot"><span class="annottext">NotAKey -&gt; Either NotAKey result
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">NotAKey
</span><a href="Orville.PostgreSQL.Plan.Many.html#NotAKey"><span class="hs-identifier hs-var">Many.NotAKey</span></a></span><span>
</span><span id="line-532"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679123752"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679123752"><span class="hs-identifier hs-var">row</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-533"></span><span>              </span><span class="annot"><span class="annottext">result -&gt; Either NotAKey result
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679123752"><span class="hs-identifier hs-var">row</span></a></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><span class="annottext">Either AssertionFailed (Many param result)
-&gt; m (Either AssertionFailed (Many param result))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either AssertionFailed (Many param result)
 -&gt; m (Either AssertionFailed (Many param result)))
-&gt; (Many param result
    -&gt; Either AssertionFailed (Many param result))
-&gt; Many param result
-&gt; m (Either AssertionFailed (Many param result))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Many param result -&gt; Either AssertionFailed (Many param result)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Many param result
 -&gt; m (Either AssertionFailed (Many param result)))
-&gt; Many param result
-&gt; m (Either AssertionFailed (Many param result))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Many param result
</span><a href="#local-6989586621679123755"><span class="hs-identifier hs-var">manyRows</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-comment">{- |
  'findSelect' builds a plan 'Operation' where the select that is run does not
  use the input parameters for the plan in any way. If the
  'executeOperationMany' function of the resulting 'Operation' will run the
  query once and use the entire result set as the result each of the input
  parameters in turn.
-}</span><span>
</span><span id="line-544"></span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#findSelect"><span class="hs-identifier hs-type">findSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679123751"><span class="annot"><a href="#local-6989586621679123751"><span class="hs-identifier hs-type">param</span></a></span></span><span> </span><span id="local-6989586621679123750"><span class="annot"><a href="#local-6989586621679123750"><span class="hs-identifier hs-type">row</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select.Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123750"><span class="hs-identifier hs-type">row</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123751"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679123750"><span class="hs-identifier hs-type">row</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span id="findSelect"><span class="annot"><span class="annottext">findSelect :: Select row -&gt; Operation param [row]
</span><a href="Orville.PostgreSQL.Plan.Operation.html#findSelect"><span class="hs-identifier hs-var hs-var">findSelect</span></a></span></span><span> </span><span id="local-6989586621679123749"><span class="annot"><span class="annottext">Select row
</span><a href="#local-6989586621679123749"><span class="hs-identifier hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679123935"><span id="local-6989586621679123936"><span class="annot"><a href="#local-6989586621679123748"><span class="hs-identifier hs-type">executeOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679123751"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679123936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679123935"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679123750"><span class="hs-identifier hs-type">row</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-547"></span><span>      </span><span id="local-6989586621679123748"><span class="annot"><span class="annottext">executeOne :: param -&gt; m (Either a [row])
</span><a href="#local-6989586621679123748"><span class="hs-identifier hs-var hs-var">executeOne</span></a></span></span><span> </span><span class="annot"><span class="annottext">param
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><span class="annottext">[row] -&gt; Either a [row]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">([row] -&gt; Either a [row]) -&gt; m [row] -&gt; m (Either a [row])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Select row -&gt; m [row]
forall (m :: * -&gt; *) row. MonadOrville m =&gt; Select row -&gt; m [row]
</span><a href="Orville.PostgreSQL.Internal.Select.html#executeSelect"><span class="hs-identifier hs-var">Select.executeSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Select row
</span><a href="#local-6989586621679123749"><span class="hs-identifier hs-var">select</span></a></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>      </span><span id="local-6989586621679123933"><span id="local-6989586621679123934"><span class="annot"><a href="#local-6989586621679123747"><span class="hs-identifier hs-type">executeMany</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123934"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679123751"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679123934"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679123933"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Plan.Many.html#Many"><span class="hs-identifier hs-type">Many</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123751"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679123750"><span class="hs-identifier hs-type">row</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-551"></span><span>      </span><span id="local-6989586621679123747"><span class="annot"><span class="annottext">executeMany :: NonEmpty param -&gt; m (Either a (Many param [row]))
</span><a href="#local-6989586621679123747"><span class="hs-identifier hs-var hs-var">executeMany</span></a></span></span><span> </span><span id="local-6989586621679123746"><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123746"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>        </span><span id="local-6989586621679123745"><span class="annot"><span class="annottext">[row]
</span><a href="#local-6989586621679123745"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Select row -&gt; m [row]
forall (m :: * -&gt; *) row. MonadOrville m =&gt; Select row -&gt; m [row]
</span><a href="Orville.PostgreSQL.Internal.Select.html#executeSelect"><span class="hs-identifier hs-var">Select.executeSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Select row
</span><a href="#local-6989586621679123749"><span class="hs-identifier hs-var">select</span></a></span><span>
</span><span id="line-553"></span><span>        </span><span class="annot"><span class="annottext">Either a (Many param [row]) -&gt; m (Either a (Many param [row]))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either a (Many param [row]) -&gt; m (Either a (Many param [row])))
-&gt; (Many param [row] -&gt; Either a (Many param [row]))
-&gt; Many param [row]
-&gt; m (Either a (Many param [row]))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Many param [row] -&gt; Either a (Many param [row])
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Many param [row] -&gt; m (Either a (Many param [row])))
-&gt; Many param [row] -&gt; m (Either a (Many param [row]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[param] -&gt; (param -&gt; Either NotAKey [row]) -&gt; Many param [row]
forall k a. [k] -&gt; (k -&gt; Either NotAKey a) -&gt; Many k a
</span><a href="Orville.PostgreSQL.Plan.Many.html#fromKeys"><span class="hs-identifier hs-var">Many.fromKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty param -&gt; [param]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty param
</span><a href="#local-6989586621679123746"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either NotAKey [row] -&gt; param -&gt; Either NotAKey [row]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[row] -&gt; Either NotAKey [row]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[row]
</span><a href="#local-6989586621679123745"><span class="hs-identifier hs-var">rows</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>      </span><span id="local-6989586621679123932"><span class="annot"><a href="#local-6989586621679123744"><span class="hs-identifier hs-type">selectToSqlString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Select.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123932"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-556"></span><span>      </span><span id="local-6989586621679123744"><span class="annot"><span class="annottext">selectToSqlString :: Select readEntity -&gt; String
</span><a href="#local-6989586621679123744"><span class="hs-identifier hs-var hs-var">selectToSqlString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-557"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">BS8.unpack</span></span><span>
</span><span id="line-558"></span><span>          </span><span class="annot"><span class="annottext">(ByteString -&gt; String)
-&gt; (Select readEntity -&gt; ByteString) -&gt; Select readEntity -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QueryExpr -&gt; ByteString
forall sql. SqlExpression sql =&gt; sql -&gt; ByteString
</span><a href="Orville.PostgreSQL.Internal.RawSql.html#toExampleBytes"><span class="hs-identifier hs-var">RawSql.toExampleBytes</span></a></span><span>
</span><span id="line-559"></span><span>          </span><span class="annot"><span class="annottext">(QueryExpr -&gt; ByteString)
-&gt; (Select readEntity -&gt; QueryExpr)
-&gt; Select readEntity
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Select readEntity -&gt; QueryExpr
forall readEntity. Select readEntity -&gt; QueryExpr
</span><a href="Orville.PostgreSQL.Internal.Select.html#selectToQueryExpr"><span class="hs-identifier hs-var">Select.selectToQueryExpr</span></a></span><span>
</span><span id="line-560"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Operation :: forall param result.
(forall (m :: * -&gt; *).
 MonadOrville m =&gt;
 param -&gt; m (Either AssertionFailed result))
-&gt; (forall (m :: * -&gt; *).
    MonadOrville m =&gt;
    NonEmpty param -&gt; m (Either AssertionFailed (Many param result)))
-&gt; Explanation
-&gt; Explanation
-&gt; Operation param result
</span><a href="Orville.PostgreSQL.Plan.Operation.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executeOperationOne :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
param -&gt; m (Either AssertionFailed [row])
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationOne"><span class="hs-identifier hs-var">executeOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadOrville m =&gt;
param -&gt; m (Either AssertionFailed [row])
forall (m :: * -&gt; *) a.
MonadOrville m =&gt;
param -&gt; m (Either a [row])
</span><a href="#local-6989586621679123748"><span class="hs-identifier hs-var">executeOne</span></a></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executeOperationMany :: forall (m :: * -&gt; *).
MonadOrville m =&gt;
NonEmpty param -&gt; m (Either AssertionFailed (Many param [row]))
</span><a href="Orville.PostgreSQL.Plan.Operation.html#executeOperationMany"><span class="hs-identifier hs-var">executeOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadOrville m =&gt;
NonEmpty param -&gt; m (Either AssertionFailed (Many param [row]))
forall (m :: * -&gt; *) a.
MonadOrville m =&gt;
NonEmpty param -&gt; m (Either a (Many param [row]))
</span><a href="#local-6989586621679123747"><span class="hs-identifier hs-var">executeMany</span></a></span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationOne :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationOne"><span class="hs-identifier hs-var">explainOperationOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#explainStep"><span class="hs-identifier hs-var">Exp.explainStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select row -&gt; String
forall readEntity. Select readEntity -&gt; String
</span><a href="#local-6989586621679123744"><span class="hs-identifier hs-var">selectToSqlString</span></a></span><span> </span><span class="annot"><span class="annottext">Select row
</span><a href="#local-6989586621679123749"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explainOperationMany :: Explanation
</span><a href="Orville.PostgreSQL.Plan.Operation.html#explainOperationMany"><span class="hs-identifier hs-var">explainOperationMany</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Explanation
</span><a href="Orville.PostgreSQL.Plan.Explanation.html#explainStep"><span class="hs-identifier hs-var">Exp.explainStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select row -&gt; String
forall readEntity. Select readEntity -&gt; String
</span><a href="#local-6989586621679123744"><span class="hs-identifier hs-var">selectToSqlString</span></a></span><span> </span><span class="annot"><span class="annottext">Select row
</span><a href="#local-6989586621679123749"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-566"></span></pre></body></html>