<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Orville.PostgreSQL.Internal.OrvilleState</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier">OrvilleState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newOrvilleState"><span class="hs-identifier">newOrvilleState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#resetOrvilleState"><span class="hs-identifier">resetOrvilleState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleConnectionPool"><span class="hs-identifier">orvilleConnectionPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleConnectionState"><span class="hs-identifier">orvilleConnectionState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleErrorDetailLevel"><span class="hs-identifier">orvilleErrorDetailLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleTransactionCallback"><span class="hs-identifier">orvilleTransactionCallback</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlCommenterAttributes"><span class="hs-identifier">orvilleSqlCommenterAttributes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addTransactionCallback"><span class="hs-identifier">addTransactionCallback</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier">TransactionEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#BeginTransaction"><span class="hs-identifier">BeginTransaction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#NewSavepoint"><span class="hs-identifier">NewSavepoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ReleaseSavepoint"><span class="hs-identifier">ReleaseSavepoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#RollbackToSavepoint"><span class="hs-identifier">RollbackToSavepoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#CommitTransaction"><span class="hs-identifier">CommitTransaction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#RollbackTransaction"><span class="hs-identifier">RollbackTransaction</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#openTransactionEvent"><span class="hs-identifier">openTransactionEvent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#rollbackTransactionEvent"><span class="hs-identifier">rollbackTransactionEvent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#transactionSuccessEvent"><span class="hs-identifier">transactionSuccessEvent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#HasOrvilleState"><span class="hs-identifier">HasOrvilleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#askOrvilleState"><span class="hs-identifier">askOrvilleState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#localOrvilleState"><span class="hs-identifier">localOrvilleState</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectionState"><span class="hs-identifier">ConnectionState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#NotConnected"><span class="hs-identifier">NotConnected</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Connected"><span class="hs-identifier">Connected</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectedState"><span class="hs-identifier">ConnectedState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectedState"><span class="hs-identifier">ConnectedState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectedConnection"><span class="hs-identifier">connectedConnection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectedTransaction"><span class="hs-identifier">connectedTransaction</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectState"><span class="hs-identifier">connectState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier">TransactionState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier">OutermostTransaction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier">SavepointTransaction</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newTransaction"><span class="hs-identifier">newTransaction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier">Savepoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#savepointNestingLevel"><span class="hs-identifier">savepointNestingLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#initialSavepoint"><span class="hs-identifier">initialSavepoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#nextSavepoint"><span class="hs-identifier">nextSavepoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlExecutionCallback"><span class="hs-identifier">orvilleSqlExecutionCallback</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addSqlExecutionCallback"><span class="hs-identifier">addSqlExecutionCallback</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleBeginTransactionExpr"><span class="hs-identifier">orvilleBeginTransactionExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#setBeginTransactionExpr"><span class="hs-identifier">setBeginTransactionExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#setSqlCommenterAttributes"><span class="hs-identifier">setSqlCommenterAttributes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addSqlCommenterAttributes"><span class="hs-identifier">addSqlCommenterAttributes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">local</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapReaderT</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Pool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pool</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Connection.html"><span class="hs-identifier">Orville.PostgreSQL.Connection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Connection.html#Connection"><span class="hs-identifier">Connection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ErrorDetailLevel.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.ErrorDetailLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.ErrorDetailLevel.html#ErrorDetailLevel"><span class="hs-identifier">ErrorDetailLevel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.Expr</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Expr</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.QueryType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html#QueryType"><span class="hs-identifier">QueryType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.RawSql</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RawSql</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlCommenter.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.SqlCommenter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SqlCommenter</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">{- |
  'OrvilleState' is used to manange opening connections to the database,
  transactions, etc. 'newOrvilleState' should be used to create an appopriate
  initial state for your monad's context.
-}</span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="OrvilleState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-var">OrvilleState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OrvilleState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-var">OrvilleState</span></a></span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_orvilleConnectionPool"><span class="annot"><span class="annottext">OrvilleState -&gt; Pool Connection
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionPool"><span class="hs-identifier hs-var hs-var">_orvilleConnectionPool</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Connection.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_orvilleConnectionState"><span class="annot"><span class="annottext">OrvilleState -&gt; ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionState"><span class="hs-identifier hs-var hs-var">_orvilleConnectionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectionState"><span class="hs-identifier hs-type">ConnectionState</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_orvilleErrorDetailLevel"><span class="annot"><span class="annottext">OrvilleState -&gt; ErrorDetailLevel
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleErrorDetailLevel"><span class="hs-identifier hs-var hs-var">_orvilleErrorDetailLevel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ErrorDetailLevel.html#ErrorDetailLevel"><span class="hs-identifier hs-type">ErrorDetailLevel</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_orvilleTransactionCallback"><span class="annot"><span class="annottext">OrvilleState -&gt; TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleTransactionCallback"><span class="hs-identifier hs-var hs-var">_orvilleTransactionCallback</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_orvilleSqlExecutionCallback"><span class="annot"><span class="annottext">OrvilleState -&gt; forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlExecutionCallback"><span class="hs-identifier hs-var hs-var">_orvilleSqlExecutionCallback</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679117646"><span class="annot"><a href="#local-6989586621679117646"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html#QueryType"><span class="hs-identifier hs-type">QueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html#RawSql"><span class="hs-identifier hs-type">RawSql.RawSql</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117646"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117646"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_orvilleBeginTransactionExpr"><span class="annot"><span class="annottext">OrvilleState -&gt; BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleBeginTransactionExpr"><span class="hs-identifier hs-var hs-var">_orvilleBeginTransactionExpr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Transaction.html#BeginTransactionExpr"><span class="hs-identifier hs-type">Expr.BeginTransactionExpr</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_orvilleSqlCommenterAttributes"><span class="annot"><span class="annottext">OrvilleState -&gt; Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var hs-var">_orvilleSqlCommenterAttributes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlCommenter.html#SqlCommenterAttributes"><span class="hs-identifier hs-type">SqlCommenter.SqlCommenterAttributes</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleConnectionPool"><span class="hs-identifier hs-type">orvilleConnectionPool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Connection.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span>
</span><span id="line-65"></span><span id="orvilleConnectionPool"><span class="annot"><span class="annottext">orvilleConnectionPool :: OrvilleState -&gt; Pool Connection
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleConnectionPool"><span class="hs-identifier hs-var hs-var">orvilleConnectionPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; Pool Connection
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionPool"><span class="hs-identifier hs-var hs-var">_orvilleConnectionPool</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleConnectionState"><span class="hs-identifier hs-type">orvilleConnectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectionState"><span class="hs-identifier hs-type">ConnectionState</span></a></span><span>
</span><span id="line-69"></span><span id="orvilleConnectionState"><span class="annot"><span class="annottext">orvilleConnectionState :: OrvilleState -&gt; ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleConnectionState"><span class="hs-identifier hs-var hs-var">orvilleConnectionState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionState"><span class="hs-identifier hs-var hs-var">_orvilleConnectionState</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleErrorDetailLevel"><span class="hs-identifier hs-type">orvilleErrorDetailLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ErrorDetailLevel.html#ErrorDetailLevel"><span class="hs-identifier hs-type">ErrorDetailLevel</span></a></span><span>
</span><span id="line-73"></span><span id="orvilleErrorDetailLevel"><span class="annot"><span class="annottext">orvilleErrorDetailLevel :: OrvilleState -&gt; ErrorDetailLevel
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleErrorDetailLevel"><span class="hs-identifier hs-var hs-var">orvilleErrorDetailLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; ErrorDetailLevel
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleErrorDetailLevel"><span class="hs-identifier hs-var hs-var">_orvilleErrorDetailLevel</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleTransactionCallback"><span class="hs-identifier hs-type">orvilleTransactionCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span id="orvilleTransactionCallback"><span class="annot"><span class="annottext">orvilleTransactionCallback :: OrvilleState -&gt; TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleTransactionCallback"><span class="hs-identifier hs-var hs-var">orvilleTransactionCallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleTransactionCallback"><span class="hs-identifier hs-var hs-var">_orvilleTransactionCallback</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleBeginTransactionExpr"><span class="hs-identifier hs-type">orvilleBeginTransactionExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Transaction.html#BeginTransactionExpr"><span class="hs-identifier hs-type">Expr.BeginTransactionExpr</span></a></span><span>
</span><span id="line-81"></span><span id="orvilleBeginTransactionExpr"><span class="annot"><span class="annottext">orvilleBeginTransactionExpr :: OrvilleState -&gt; BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleBeginTransactionExpr"><span class="hs-identifier hs-var hs-var">orvilleBeginTransactionExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleBeginTransactionExpr"><span class="hs-identifier hs-var hs-var">_orvilleBeginTransactionExpr</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlCommenterAttributes"><span class="hs-identifier hs-type">orvilleSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlCommenter.html#SqlCommenterAttributes"><span class="hs-identifier hs-type">SqlCommenter.SqlCommenterAttributes</span></a></span><span>
</span><span id="line-85"></span><span id="orvilleSqlCommenterAttributes"><span class="annot"><span class="annottext">orvilleSqlCommenterAttributes :: OrvilleState -&gt; Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var hs-var">orvilleSqlCommenterAttributes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var hs-var">_orvilleSqlCommenterAttributes</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">{- |
  Registers a callback to be invoked during transactions.

  The callback given will be called after the SQL statement corresponding
  to the given event has finished executing. Callbacks will be called
  in the order the are added.

  Note: There is no specialized error handling for these callbacks. This means
  that if a callback raises an exception no further callbacks will be called
  and the exception will propagate up until it caught elsewhere. In particular,
  if an exception is raised by a callback upon opening the transaction it will
  cause the transaction to be rolled-back the same as any other exception that
  might happen during the transaction. In general, we recommend only using
  callbacks that either raise no exceptions or can handle their own exceptions
  cleanly.
-}</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addTransactionCallback"><span class="hs-identifier hs-type">addTransactionCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-108"></span><span id="addTransactionCallback"><span class="annot"><span class="annottext">addTransactionCallback :: (TransactionEvent -&gt; IO ()) -&gt; OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addTransactionCallback"><span class="hs-identifier hs-var hs-var">addTransactionCallback</span></a></span></span><span> </span><span id="local-6989586621679117542"><span class="annot"><span class="annottext">TransactionEvent -&gt; IO ()
</span><a href="#local-6989586621679117542"><span class="hs-identifier hs-var">newCallback</span></a></span></span><span> </span><span id="local-6989586621679117541"><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117541"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117540"><span class="annot"><span class="annottext">originalCallback :: TransactionEvent -&gt; IO ()
</span><a href="#local-6989586621679117540"><span class="hs-identifier hs-var hs-var">originalCallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><span class="annottext">OrvilleState -&gt; TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleTransactionCallback"><span class="hs-identifier hs-var hs-var">_orvilleTransactionCallback</span></a></span><span> </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117541"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>      </span><span id="local-6989586621679117539"><span class="annot"><span class="annottext">wrappedCallback :: TransactionEvent -&gt; IO ()
</span><a href="#local-6989586621679117539"><span class="hs-identifier hs-var hs-var">wrappedCallback</span></a></span></span><span> </span><span id="local-6989586621679117538"><span class="annot"><span class="annottext">TransactionEvent
</span><a href="#local-6989586621679117538"><span class="hs-identifier hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">TransactionEvent -&gt; IO ()
</span><a href="#local-6989586621679117540"><span class="hs-identifier hs-var">originalCallback</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionEvent
</span><a href="#local-6989586621679117538"><span class="hs-identifier hs-var">event</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">TransactionEvent -&gt; IO ()
</span><a href="#local-6989586621679117542"><span class="hs-identifier hs-var">newCallback</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionEvent
</span><a href="#local-6989586621679117538"><span class="hs-identifier hs-var">event</span></a></span><span>
</span><span id="line-115"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117541"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_orvilleTransactionCallback :: TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleTransactionCallback"><span class="hs-identifier hs-var">_orvilleTransactionCallback</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionEvent -&gt; IO ()
</span><a href="#local-6989586621679117539"><span class="hs-identifier hs-var">wrappedCallback</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">{- |
  'HasOrvilleState' is the typeclass that Orville uses to access and manange
  the connection pool and state tracking when it is being executed inside an
  unknown Monad. It is a specialized version of the Reader interface so that it
  can easily implemented by application Monads that already have a Reader
  context and want to simply add 'OrvilleState' as an attribute to that
  context, like so

  @
    data MyApplicationState =
      MyApplicationState
        { appConfig :: MyAppConfig
        , appOrvilleState :: OrvilleState
        }

    newtype MyApplicationMonad a =
      MyApplicationMonad (ReaderT MyApplicationState IO) a

    instance HasOrvilleState MyApplicationMonad where
      askOrvilleState =
        MyApplicationMonad (asks appOrvilleState)

      localOrvilleState f (MyApplicationMonad reader) =
        MyApplicationMonad $
          local
            (\state -&gt; state { appOrvilleState = f (appOrvilleState state))
            reader
  @

  An instance for 'ReaderT OrvilleState m' is provided as a convenience in
  the case that your application has no extra context to track.
-}</span><span>
</span><span id="line-149"></span><span class="hs-keyword">class</span><span> </span><span id="HasOrvilleState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#HasOrvilleState"><span class="hs-identifier hs-var">HasOrvilleState</span></a></span></span><span> </span><span id="local-6989586621679117639"><span class="annot"><a href="#local-6989586621679117639"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-comment">{-
    Fetches the current 'OrvilleState' from the host Monad context. The
    equivalent of 'ask' for 'ReaderT OrvilleState'
  -}</span><span>
</span><span id="line-154"></span><span>  </span><span id="askOrvilleState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#askOrvilleState"><span class="hs-identifier hs-type">askOrvilleState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679117639"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">{-
    Applies a modification to the 'OrvilleState' that is local to the given
    monad operation. Calls to 'askOrvilleState' made within the 'm a' provided
    must return the modified state. The modified state must only apply to
    the given 'm a' and not persisted beyond it. The equivalent of 'local'
    for 'ReaderT OrvilleState'
  -}</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621679117641"><span id="localOrvilleState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#localOrvilleState"><span class="hs-identifier hs-type">localOrvilleState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- | The function to modify the 'OrvilleState'</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- | The monad operation to execute with the modified state</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="#local-6989586621679117639"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117641"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="#local-6989586621679117639"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117641"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621679117537"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679117537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#HasOrvilleState"><span class="hs-identifier hs-type">HasOrvilleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117537"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621679117533"><span class="annot"><span class="annottext">askOrvilleState :: ReaderT OrvilleState m OrvilleState
</span><a href="#local-6989586621679117533"><span class="hs-identifier hs-var hs-var hs-var hs-var">askOrvilleState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT OrvilleState m OrvilleState
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-172"></span><span>  </span><span id="local-6989586621679117532"><span class="annot"><span class="annottext">localOrvilleState :: (OrvilleState -&gt; OrvilleState)
-&gt; ReaderT OrvilleState m a -&gt; ReaderT OrvilleState m a
</span><a href="#local-6989586621679117532"><span class="hs-identifier hs-var hs-var hs-var hs-var">localOrvilleState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OrvilleState -&gt; OrvilleState)
-&gt; ReaderT OrvilleState m a -&gt; ReaderT OrvilleState m a
forall r (m :: * -&gt; *) a.
(r -&gt; r) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">local</span></span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span id="local-6989586621679117530"><span id="local-6989586621679117531"><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPS</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679117531"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#HasOrvilleState"><span class="hs-identifier hs-type">HasOrvilleState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117531"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#HasOrvilleState"><span class="hs-identifier hs-type">HasOrvilleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679117530"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117531"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621679117527"><span class="annot"><span class="annottext">askOrvilleState :: ReaderT r m OrvilleState
</span><a href="#local-6989586621679117527"><span class="hs-identifier hs-var hs-var hs-var hs-var">askOrvilleState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m OrvilleState -&gt; ReaderT r m OrvilleState
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m OrvilleState
forall (m :: * -&gt; *). HasOrvilleState m =&gt; m OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#askOrvilleState"><span class="hs-identifier hs-var">askOrvilleState</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621679117526"><span class="annot"><span class="annottext">localOrvilleState :: (OrvilleState -&gt; OrvilleState) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><a href="#local-6989586621679117526"><span class="hs-identifier hs-var hs-var hs-var hs-var">localOrvilleState</span></a></span></span><span> </span><span id="local-6989586621679117525"><span class="annot"><span class="annottext">OrvilleState -&gt; OrvilleState
</span><a href="#local-6989586621679117525"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; ReaderT r m a -&gt; ReaderT r m a
forall (m :: * -&gt; *) a (n :: * -&gt; *) b r.
(m a -&gt; n b) -&gt; ReaderT r m a -&gt; ReaderT r n b
</span><span class="hs-identifier hs-var">mapReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OrvilleState -&gt; OrvilleState) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
HasOrvilleState m =&gt;
(OrvilleState -&gt; OrvilleState) -&gt; m a -&gt; m a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#localOrvilleState"><span class="hs-identifier hs-var">localOrvilleState</span></a></span><span> </span><span class="annot"><span class="annottext">OrvilleState -&gt; OrvilleState
</span><a href="#local-6989586621679117525"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">{- |
  Creates a appropriate initial 'OrvilleState' that will use the connection
  pool given to initiate connections to the database.
-}</span><span>
</span><span id="line-182"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newOrvilleState"><span class="hs-identifier hs-type">newOrvilleState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ErrorDetailLevel.html#ErrorDetailLevel"><span class="hs-identifier hs-type">ErrorDetailLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Connection.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-183"></span><span id="newOrvilleState"><span class="annot"><span class="annottext">newOrvilleState :: ErrorDetailLevel -&gt; Pool Connection -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newOrvilleState"><span class="hs-identifier hs-var hs-var">newOrvilleState</span></a></span></span><span> </span><span id="local-6989586621679117524"><span class="annot"><span class="annottext">ErrorDetailLevel
</span><a href="#local-6989586621679117524"><span class="hs-identifier hs-var">errorDetailLevel</span></a></span></span><span> </span><span id="local-6989586621679117523"><span class="annot"><span class="annottext">Pool Connection
</span><a href="#local-6989586621679117523"><span class="hs-identifier hs-var">pool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState :: Pool Connection
-&gt; ConnectionState
-&gt; ErrorDetailLevel
-&gt; (TransactionEvent -&gt; IO ())
-&gt; (forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a)
-&gt; BeginTransactionExpr
-&gt; Maybe SqlCommenterAttributes
-&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_orvilleConnectionPool :: Pool Connection
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionPool"><span class="hs-identifier hs-var">_orvilleConnectionPool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pool Connection
</span><a href="#local-6989586621679117523"><span class="hs-identifier hs-var">pool</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_orvilleConnectionState :: ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionState"><span class="hs-identifier hs-var">_orvilleConnectionState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#NotConnected"><span class="hs-identifier hs-var">NotConnected</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_orvilleErrorDetailLevel :: ErrorDetailLevel
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleErrorDetailLevel"><span class="hs-identifier hs-var">_orvilleErrorDetailLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorDetailLevel
</span><a href="#local-6989586621679117524"><span class="hs-identifier hs-var">errorDetailLevel</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_orvilleTransactionCallback :: TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleTransactionCallback"><span class="hs-identifier hs-var">_orvilleTransactionCallback</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultTransactionCallback"><span class="hs-identifier hs-var">defaultTransactionCallback</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_orvilleSqlExecutionCallback :: forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlExecutionCallback"><span class="hs-identifier hs-var">_orvilleSqlExecutionCallback</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultSqlExectionCallback"><span class="hs-identifier hs-var">defaultSqlExectionCallback</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_orvilleBeginTransactionExpr :: BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleBeginTransactionExpr"><span class="hs-identifier hs-var">_orvilleBeginTransactionExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultBeginTransactionExpr"><span class="hs-identifier hs-var">defaultBeginTransactionExpr</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_orvilleSqlCommenterAttributes :: Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var">_orvilleSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SqlCommenterAttributes
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">{- |
  Creates a new initial 'OrvilleState' using the connection pool from the
  provide state. You might need to use this if you are spawning one Orville
  monad from another and they should not share the same connection and
  transaction state.
-}</span><span>
</span><span id="line-200"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#resetOrvilleState"><span class="hs-identifier hs-type">resetOrvilleState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-201"></span><span id="resetOrvilleState"><span class="annot"><span class="annottext">resetOrvilleState :: OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#resetOrvilleState"><span class="hs-identifier hs-var hs-var">resetOrvilleState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">ErrorDetailLevel -&gt; Pool Connection -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newOrvilleState"><span class="hs-identifier hs-var">newOrvilleState</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">(ErrorDetailLevel -&gt; Pool Connection -&gt; OrvilleState)
-&gt; (OrvilleState -&gt; ErrorDetailLevel)
-&gt; OrvilleState
-&gt; Pool Connection
-&gt; OrvilleState
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OrvilleState -&gt; ErrorDetailLevel
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleErrorDetailLevel"><span class="hs-identifier hs-var hs-var">_orvilleErrorDetailLevel</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">(OrvilleState -&gt; Pool Connection -&gt; OrvilleState)
-&gt; (OrvilleState -&gt; Pool Connection)
-&gt; OrvilleState
-&gt; OrvilleState
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">OrvilleState -&gt; Pool Connection
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionPool"><span class="hs-identifier hs-var hs-var">_orvilleConnectionPool</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">{- |
  INTERNAL: Transitions the 'OrvilleState' into &quot;connected&quot; status, storing
  the given 'Connection' as the database connection to be used to execute
  all queries. This is used by 'withConnection' to track the connection it
  retrieves from the pool.
-}</span><span>
</span><span id="line-212"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectState"><span class="hs-identifier hs-type">connectState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectedState"><span class="hs-identifier hs-type">ConnectedState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-213"></span><span id="connectState"><span class="annot"><span class="annottext">connectState :: ConnectedState -&gt; OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectState"><span class="hs-identifier hs-var hs-var">connectState</span></a></span></span><span> </span><span id="local-6989586621679117518"><span class="annot"><span class="annottext">ConnectedState
</span><a href="#local-6989586621679117518"><span class="hs-identifier hs-var">connectedState</span></a></span></span><span> </span><span id="local-6989586621679117517"><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117517"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117517"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_orvilleConnectionState :: ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleConnectionState"><span class="hs-identifier hs-var">_orvilleConnectionState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnectedState -&gt; ConnectionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectedState
</span><a href="#local-6989586621679117518"><span class="hs-identifier hs-var">connectedState</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">{- |
  INTERNAL: This type is used to signal whether a database connection has
  been retrieved from the pool for the current operation or not. The
  value is tracked in the 'OrvilleState' for the host monad, and is checked
  by 'withConnection' to avoid checking out two separate connections for a
  multiple operations that needs to be run on the same connection (e.g.
  multiple operations inside a transaction).
-}</span><span>
</span><span id="line-226"></span><span class="hs-keyword">data</span><span> </span><span id="ConnectionState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectionState"><span class="hs-identifier hs-var">ConnectionState</span></a></span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NotConnected"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#NotConnected"><span class="hs-identifier hs-var">NotConnected</span></a></span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Connected"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectedState"><span class="hs-identifier hs-type">ConnectedState</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-keyword">data</span><span> </span><span id="ConnectedState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectedState"><span class="hs-identifier hs-var">ConnectedState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ConnectedState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ConnectedState"><span class="hs-identifier hs-var">ConnectedState</span></a></span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="connectedConnection"><span class="annot"><span class="annottext">ConnectedState -&gt; Connection
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectedConnection"><span class="hs-identifier hs-var hs-var">connectedConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Connection.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="connectedTransaction"><span class="annot"><span class="annottext">ConnectedState -&gt; Maybe TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#connectedTransaction"><span class="hs-identifier hs-var hs-var">connectedTransaction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-type">TransactionState</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-keyword">data</span><span> </span><span id="TransactionState"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-var">TransactionState</span></a></span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="OutermostTransaction"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier hs-var">OutermostTransaction</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SavepointTransaction"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-var">SavepointTransaction</span></a></span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newTransaction"><span class="hs-identifier hs-type">newTransaction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-type">TransactionState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-type">TransactionState</span></a></span><span>
</span><span id="line-240"></span><span id="newTransaction"><span class="annot"><span class="annottext">newTransaction :: Maybe TransactionState -&gt; TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#newTransaction"><span class="hs-identifier hs-var hs-var">newTransaction</span></a></span></span><span> </span><span id="local-6989586621679117516"><span class="annot"><span class="annottext">Maybe TransactionState
</span><a href="#local-6989586621679117516"><span class="hs-identifier hs-var">maybeTransactionState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TransactionState
</span><a href="#local-6989586621679117516"><span class="hs-identifier hs-var">maybeTransactionState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">Maybe TransactionState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier hs-var">OutermostTransaction</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier hs-var">OutermostTransaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">Savepoint -&gt; TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-var">SavepointTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#initialSavepoint"><span class="hs-identifier hs-var">initialSavepoint</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-type">SavepointTransaction</span></a></span><span> </span><span id="local-6989586621679117515"><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117515"><span class="hs-identifier hs-var">savepoint</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">Savepoint -&gt; TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-var">SavepointTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Savepoint -&gt; Savepoint
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#nextSavepoint"><span class="hs-identifier hs-var">nextSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117515"><span class="hs-identifier hs-var">savepoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">{- |
  A internal Orville identifier for a savepoint in a PostgreSQL transaction.
-}</span><span>
</span><span id="line-252"></span><span class="hs-keyword">newtype</span><span> </span><span id="Savepoint"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-var">Savepoint</span></a></span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Savepoint"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-var">Savepoint</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679117510"><span id="local-6989586621679117512"><span class="annot"><span class="annottext">Savepoint -&gt; Savepoint -&gt; Bool
(Savepoint -&gt; Savepoint -&gt; Bool)
-&gt; (Savepoint -&gt; Savepoint -&gt; Bool) -&gt; Eq Savepoint
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Savepoint -&gt; Savepoint -&gt; Bool
$c/= :: Savepoint -&gt; Savepoint -&gt; Bool
== :: Savepoint -&gt; Savepoint -&gt; Bool
$c== :: Savepoint -&gt; Savepoint -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117503"><span id="local-6989586621679117505"><span id="local-6989586621679117507"><span class="annot"><span class="annottext">Int -&gt; Savepoint -&gt; ShowS
[Savepoint] -&gt; ShowS
Savepoint -&gt; String
(Int -&gt; Savepoint -&gt; ShowS)
-&gt; (Savepoint -&gt; String)
-&gt; ([Savepoint] -&gt; ShowS)
-&gt; Show Savepoint
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Savepoint] -&gt; ShowS
$cshowList :: [Savepoint] -&gt; ShowS
show :: Savepoint -&gt; String
$cshow :: Savepoint -&gt; String
showsPrec :: Int -&gt; Savepoint -&gt; ShowS
$cshowsPrec :: Int -&gt; Savepoint -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#initialSavepoint"><span class="hs-identifier hs-type">initialSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-257"></span><span id="initialSavepoint"><span class="annot"><span class="annottext">initialSavepoint :: Savepoint
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#initialSavepoint"><span class="hs-identifier hs-var hs-var">initialSavepoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Savepoint
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-var">Savepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#nextSavepoint"><span class="hs-identifier hs-type">nextSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-261"></span><span id="nextSavepoint"><span class="annot"><span class="annottext">nextSavepoint :: Savepoint -&gt; Savepoint
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#nextSavepoint"><span class="hs-identifier hs-var hs-var">nextSavepoint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span id="local-6989586621679117501"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117501"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Savepoint
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-var">Savepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117501"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#savepointNestingLevel"><span class="hs-identifier hs-type">savepointNestingLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-265"></span><span id="savepointNestingLevel"><span class="annot"><span class="annottext">savepointNestingLevel :: Savepoint -&gt; Int
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#savepointNestingLevel"><span class="hs-identifier hs-var hs-var">savepointNestingLevel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span id="local-6989586621679117499"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117499"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117499"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">{- |
  Describes an event in the lifecycle of a database transaction. You can use
  'addTransactionCallBack' to register a callback to respond to these events.
  The callback will be called after the even in question has been succesfully
  executed.
-}</span><span>
</span><span id="line-273"></span><span class="hs-keyword">data</span><span> </span><span id="TransactionEvent"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-var">TransactionEvent</span></a></span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Indicates a new transaction has been started</span><span>
</span><span id="line-275"></span><span>    </span><span id="BeginTransaction"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#BeginTransaction"><span class="hs-identifier hs-var">BeginTransaction</span></a></span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Indicates that a new savepoint has been saved within a transaction</span><span>
</span><span id="line-277"></span><span>    </span><span id="NewSavepoint"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#NewSavepoint"><span class="hs-identifier hs-var">NewSavepoint</span></a></span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Indicates that a previous savepoint has been released. It can no</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-comment">-- longer be rolled back to.</span><span>
</span><span id="line-280"></span><span>    </span><span id="ReleaseSavepoint"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ReleaseSavepoint"><span class="hs-identifier hs-var">ReleaseSavepoint</span></a></span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Indicates that rollbac was performed to a prior savepoint.</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- Note: It is possible to rollback to a savepoint prior to the most recent</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">-- one without releasing or rolling back to intermediate savepoints. Doing</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- so destroys any savepoints created after given savepoint. Although</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- Orville currently always matches 'NewSavepoint' with either</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-comment">-- 'ReleaseSavepoint' or 'RollbackToSavepoint', it is recommended that you</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-comment">-- do not rely on this behavior.</span><span>
</span><span id="line-289"></span><span>    </span><span id="RollbackToSavepoint"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#RollbackToSavepoint"><span class="hs-identifier hs-var">RollbackToSavepoint</span></a></span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Indicates that the transaction has been committed.</span><span>
</span><span id="line-291"></span><span>    </span><span id="CommitTransaction"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#CommitTransaction"><span class="hs-identifier hs-var">CommitTransaction</span></a></span></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Indicates that the transaction has been rolled back.</span><span>
</span><span id="line-293"></span><span>    </span><span id="RollbackTransaction"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#RollbackTransaction"><span class="hs-identifier hs-var">RollbackTransaction</span></a></span></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679117495"><span id="local-6989586621679117497"><span class="annot"><span class="annottext">TransactionEvent -&gt; TransactionEvent -&gt; Bool
(TransactionEvent -&gt; TransactionEvent -&gt; Bool)
-&gt; (TransactionEvent -&gt; TransactionEvent -&gt; Bool)
-&gt; Eq TransactionEvent
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TransactionEvent -&gt; TransactionEvent -&gt; Bool
$c/= :: TransactionEvent -&gt; TransactionEvent -&gt; Bool
== :: TransactionEvent -&gt; TransactionEvent -&gt; Bool
$c== :: TransactionEvent -&gt; TransactionEvent -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117489"><span id="local-6989586621679117491"><span id="local-6989586621679117493"><span class="annot"><span class="annottext">Int -&gt; TransactionEvent -&gt; ShowS
[TransactionEvent] -&gt; ShowS
TransactionEvent -&gt; String
(Int -&gt; TransactionEvent -&gt; ShowS)
-&gt; (TransactionEvent -&gt; String)
-&gt; ([TransactionEvent] -&gt; ShowS)
-&gt; Show TransactionEvent
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TransactionEvent] -&gt; ShowS
$cshowList :: [TransactionEvent] -&gt; ShowS
show :: TransactionEvent -&gt; String
$cshow :: TransactionEvent -&gt; String
showsPrec :: Int -&gt; TransactionEvent -&gt; ShowS
$cshowsPrec :: Int -&gt; TransactionEvent -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultTransactionCallback"><span class="hs-identifier hs-type">defaultTransactionCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span id="defaultTransactionCallback"><span class="annot"><span class="annottext">defaultTransactionCallback :: TransactionEvent -&gt; IO ()
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultTransactionCallback"><span class="hs-identifier hs-var hs-var">defaultTransactionCallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; TransactionEvent -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#openTransactionEvent"><span class="hs-identifier hs-type">openTransactionEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-type">TransactionState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span>
</span><span id="line-300"></span><span id="openTransactionEvent"><span class="annot"><span class="annottext">openTransactionEvent :: TransactionState -&gt; TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#openTransactionEvent"><span class="hs-identifier hs-var hs-var">openTransactionEvent</span></a></span></span><span> </span><span id="local-6989586621679117487"><span class="annot"><span class="annottext">TransactionState
</span><a href="#local-6989586621679117487"><span class="hs-identifier hs-var">txnState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionState
</span><a href="#local-6989586621679117487"><span class="hs-identifier hs-var">txnState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier hs-var">OutermostTransaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#BeginTransaction"><span class="hs-identifier hs-var">BeginTransaction</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-type">SavepointTransaction</span></a></span><span> </span><span id="local-6989586621679117486"><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117486"><span class="hs-identifier hs-var">savepoint</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Savepoint -&gt; TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#NewSavepoint"><span class="hs-identifier hs-var">NewSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117486"><span class="hs-identifier hs-var">savepoint</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#rollbackTransactionEvent"><span class="hs-identifier hs-type">rollbackTransactionEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-type">TransactionState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span>
</span><span id="line-306"></span><span id="rollbackTransactionEvent"><span class="annot"><span class="annottext">rollbackTransactionEvent :: TransactionState -&gt; TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#rollbackTransactionEvent"><span class="hs-identifier hs-var hs-var">rollbackTransactionEvent</span></a></span></span><span> </span><span id="local-6989586621679117485"><span class="annot"><span class="annottext">TransactionState
</span><a href="#local-6989586621679117485"><span class="hs-identifier hs-var">txnState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionState
</span><a href="#local-6989586621679117485"><span class="hs-identifier hs-var">txnState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier hs-var">OutermostTransaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#RollbackTransaction"><span class="hs-identifier hs-var">RollbackTransaction</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-type">SavepointTransaction</span></a></span><span> </span><span id="local-6989586621679117484"><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117484"><span class="hs-identifier hs-var">savepoint</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Savepoint -&gt; TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#RollbackToSavepoint"><span class="hs-identifier hs-var">RollbackToSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117484"><span class="hs-identifier hs-var">savepoint</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#transactionSuccessEvent"><span class="hs-identifier hs-type">transactionSuccessEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionState"><span class="hs-identifier hs-type">TransactionState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#TransactionEvent"><span class="hs-identifier hs-type">TransactionEvent</span></a></span><span>
</span><span id="line-312"></span><span id="transactionSuccessEvent"><span class="annot"><span class="annottext">transactionSuccessEvent :: TransactionState -&gt; TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#transactionSuccessEvent"><span class="hs-identifier hs-var hs-var">transactionSuccessEvent</span></a></span></span><span> </span><span id="local-6989586621679117483"><span class="annot"><span class="annottext">TransactionState
</span><a href="#local-6989586621679117483"><span class="hs-identifier hs-var">txnState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionState
</span><a href="#local-6989586621679117483"><span class="hs-identifier hs-var">txnState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">TransactionState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OutermostTransaction"><span class="hs-identifier hs-var">OutermostTransaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#CommitTransaction"><span class="hs-identifier hs-var">CommitTransaction</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#SavepointTransaction"><span class="hs-identifier hs-type">SavepointTransaction</span></a></span><span> </span><span id="local-6989586621679117482"><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117482"><span class="hs-identifier hs-var">savepoint</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Savepoint -&gt; TransactionEvent
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#ReleaseSavepoint"><span class="hs-identifier hs-var">ReleaseSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679117482"><span class="hs-identifier hs-var">savepoint</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlExecutionCallback"><span class="hs-identifier hs-type">orvilleSqlExecutionCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679117481"><span class="annot"><a href="#local-6989586621679117481"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-320"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html#QueryType"><span class="hs-identifier hs-type">QueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html#RawSql"><span class="hs-identifier hs-type">RawSql.RawSql</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117481"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117481"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-324"></span><span id="orvilleSqlExecutionCallback"><span class="annot"><span class="annottext">orvilleSqlExecutionCallback :: OrvilleState -&gt; forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlExecutionCallback"><span class="hs-identifier hs-var hs-var">orvilleSqlExecutionCallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState -&gt; QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
OrvilleState -&gt; forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlExecutionCallback"><span class="hs-identifier hs-var hs-var">_orvilleSqlExecutionCallback</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span id="local-6989586621679117480"><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultSqlExectionCallback"><span class="hs-identifier hs-type">defaultSqlExectionCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html#QueryType"><span class="hs-identifier hs-type">QueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html#RawSql"><span class="hs-identifier hs-type">RawSql.RawSql</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117480"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117480"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-328"></span><span id="defaultSqlExectionCallback"><span class="annot"><span class="annottext">defaultSqlExectionCallback :: QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultSqlExectionCallback"><span class="hs-identifier hs-var hs-var">defaultSqlExectionCallback</span></a></span></span><span> </span><span class="annot"><span class="annottext">QueryType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RawSql
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679117479"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679117479"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679117479"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">{- |
  Adds a callback to be called when an Orville operation executes a SQL
  statement. The callback is given the IO action that will perform the
  query execution and must call that action for the query to be run.
  In particular, you can use this to time query and log any that are slow.

  Calls to any previously added callbacks will also be execute as part of
  the IO action passed to the new callback. Thus the newly added callback
  happens &quot;around&quot; the previously added callback.

  There is no special exception handling done for these callbacks beyond what
  they implement themelves. Any callbacks should allow for the possibility that
  the IO action they are given may raise an exception.
-}</span><span>
</span><span id="line-344"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addSqlExecutionCallback"><span class="hs-identifier hs-type">addSqlExecutionCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679117478"><span class="annot"><a href="#local-6989586621679117478"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html#QueryType"><span class="hs-identifier hs-type">QueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html#RawSql"><span class="hs-identifier hs-type">RawSql.RawSql</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117478"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-348"></span><span id="addSqlExecutionCallback"><span class="annot"><span class="annottext">addSqlExecutionCallback :: (forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a)
-&gt; OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addSqlExecutionCallback"><span class="hs-identifier hs-var hs-var">addSqlExecutionCallback</span></a></span></span><span> </span><span id="local-6989586621679117477"><span class="annot"><span class="annottext">forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679117477"><span class="hs-identifier hs-var">outerCallback</span></a></span></span><span> </span><span id="local-6989586621679117476"><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117476"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117475"><span class="annot"><a href="#local-6989586621679117474"><span class="hs-identifier hs-type">layeredCallback</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679117473"><span class="hs-identifier hs-type">innerCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html#QueryType"><span class="hs-identifier hs-type">QueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.RawSql.html#RawSql"><span class="hs-identifier hs-type">RawSql.RawSql</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679117475"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-350"></span><span>      </span><span id="local-6989586621679117474"><span class="annot"><span class="annottext">layeredCallback :: QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679117474"><span class="hs-identifier hs-var hs-var">layeredCallback</span></a></span></span><span> </span><span id="local-6989586621679117472"><span class="annot"><span class="annottext">QueryType
</span><a href="#local-6989586621679117472"><span class="hs-identifier hs-var">queryType</span></a></span></span><span> </span><span id="local-6989586621679117471"><span class="annot"><span class="annottext">RawSql
</span><a href="#local-6989586621679117471"><span class="hs-identifier hs-var">sql</span></a></span></span><span> </span><span id="local-6989586621679117470"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679117470"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679117477"><span class="hs-identifier hs-var">outerCallback</span></a></span><span> </span><span class="annot"><span class="annottext">QueryType
</span><a href="#local-6989586621679117472"><span class="hs-identifier hs-var">queryType</span></a></span><span> </span><span class="annot"><span class="annottext">RawSql
</span><a href="#local-6989586621679117471"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679117473"><span class="hs-identifier hs-var">innerCallback</span></a></span><span> </span><span class="annot"><span class="annottext">QueryType
</span><a href="#local-6989586621679117472"><span class="hs-identifier hs-var">queryType</span></a></span><span> </span><span class="annot"><span class="annottext">RawSql
</span><a href="#local-6989586621679117471"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679117470"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>      </span><span id="local-6989586621679117473"><span class="annot"><span class="annottext">innerCallback :: QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679117473"><span class="hs-identifier hs-var hs-var">innerCallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrvilleState -&gt; forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlExecutionCallback"><span class="hs-identifier hs-var hs-var">_orvilleSqlExecutionCallback</span></a></span><span> </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117476"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-353"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117476"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_orvilleSqlExecutionCallback :: forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlExecutionCallback"><span class="hs-identifier hs-var">_orvilleSqlExecutionCallback</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. QueryType -&gt; RawSql -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679117474"><span class="hs-identifier hs-var">layeredCallback</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultBeginTransactionExpr"><span class="hs-identifier hs-type">defaultBeginTransactionExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Transaction.html#BeginTransactionExpr"><span class="hs-identifier hs-type">Expr.BeginTransactionExpr</span></a></span><span>
</span><span id="line-356"></span><span id="defaultBeginTransactionExpr"><span class="annot"><span class="annottext">defaultBeginTransactionExpr :: BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#defaultBeginTransactionExpr"><span class="hs-identifier hs-var hs-var">defaultBeginTransactionExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="annottext">Maybe TransactionMode -&gt; BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.Expr.Transaction.html#beginTransaction"><span class="hs-identifier hs-var">Expr.beginTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TransactionMode
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">{- |
  Sets the SQL expression that Orville will use to begin transactions. You can
  control the transaction isolation level by building your own
  'Expr.BeginTransactionExpr' with the desired isolation level.
-}</span><span>
</span><span id="line-364"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#setBeginTransactionExpr"><span class="hs-identifier hs-type">setBeginTransactionExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Transaction.html#BeginTransactionExpr"><span class="hs-identifier hs-type">Expr.BeginTransactionExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-368"></span><span id="setBeginTransactionExpr"><span class="annot"><span class="annottext">setBeginTransactionExpr :: BeginTransactionExpr -&gt; OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#setBeginTransactionExpr"><span class="hs-identifier hs-var hs-var">setBeginTransactionExpr</span></a></span></span><span> </span><span id="local-6989586621679117468"><span class="annot"><span class="annottext">BeginTransactionExpr
</span><a href="#local-6989586621679117468"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621679117467"><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117467"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117467"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_orvilleBeginTransactionExpr :: BeginTransactionExpr
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleBeginTransactionExpr"><span class="hs-identifier hs-var">_orvilleBeginTransactionExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BeginTransactionExpr
</span><a href="#local-6989586621679117468"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">{- |
  Sets the SqlCommenterAttributes that Orville will then add to any following statement executions.

  @since 0.10.0
-}</span><span>
</span><span id="line-378"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#setSqlCommenterAttributes"><span class="hs-identifier hs-type">setSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlCommenter.html#SqlCommenterAttributes"><span class="hs-identifier hs-type">SqlCommenter.SqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-382"></span><span id="setSqlCommenterAttributes"><span class="annot"><span class="annottext">setSqlCommenterAttributes :: SqlCommenterAttributes -&gt; OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#setSqlCommenterAttributes"><span class="hs-identifier hs-var hs-var">setSqlCommenterAttributes</span></a></span></span><span> </span><span id="local-6989586621679117466"><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117466"><span class="hs-identifier hs-var">comments</span></a></span></span><span> </span><span id="local-6989586621679117465"><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117465"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117465"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_orvilleSqlCommenterAttributes :: Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var">_orvilleSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes -&gt; Maybe SqlCommenterAttributes
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117466"><span class="hs-identifier hs-var">comments</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">{- |
  Adds the SqlCommenterAttributes to the already existing that Orville will then add to any following statement executions.

  @since 0.10.0
-}</span><span>
</span><span id="line-392"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addSqlCommenterAttributes"><span class="hs-identifier hs-type">addSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlCommenter.html#SqlCommenterAttributes"><span class="hs-identifier hs-type">SqlCommenter.SqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.OrvilleState.html#OrvilleState"><span class="hs-identifier hs-type">OrvilleState</span></a></span><span>
</span><span id="line-396"></span><span id="addSqlCommenterAttributes"><span class="annot"><span class="annottext">addSqlCommenterAttributes :: SqlCommenterAttributes -&gt; OrvilleState -&gt; OrvilleState
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#addSqlCommenterAttributes"><span class="hs-identifier hs-var hs-var">addSqlCommenterAttributes</span></a></span></span><span> </span><span id="local-6989586621679117464"><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117464"><span class="hs-identifier hs-var">comments</span></a></span></span><span> </span><span id="local-6989586621679117463"><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117463"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OrvilleState -&gt; Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var">orvilleSqlCommenterAttributes</span></a></span><span> </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117463"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>    </span><span class="annot"><span class="annottext">Maybe SqlCommenterAttributes
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117463"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_orvilleSqlCommenterAttributes :: Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var">_orvilleSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes -&gt; Maybe SqlCommenterAttributes
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117464"><span class="hs-identifier hs-var">comments</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679117462"><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117462"><span class="hs-identifier hs-var">existingAttrs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>      </span><span class="annot"><span class="annottext">OrvilleState
</span><a href="#local-6989586621679117463"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_orvilleSqlCommenterAttributes :: Maybe SqlCommenterAttributes
</span><a href="Orville.PostgreSQL.Internal.OrvilleState.html#_orvilleSqlCommenterAttributes"><span class="hs-identifier hs-var">_orvilleSqlCommenterAttributes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes -&gt; Maybe SqlCommenterAttributes
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(SqlCommenterAttributes -&gt; Maybe SqlCommenterAttributes)
-&gt; SqlCommenterAttributes -&gt; Maybe SqlCommenterAttributes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes
-&gt; SqlCommenterAttributes -&gt; SqlCommenterAttributes
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117464"><span class="hs-identifier hs-var">comments</span></a></span><span> </span><span class="annot"><span class="annottext">SqlCommenterAttributes
</span><a href="#local-6989586621679117462"><span class="hs-identifier hs-var">existingAttrs</span></a></span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-406"></span></pre></body></html>