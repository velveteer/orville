<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">{- |

Module    : Orville.PostgreSQL.Internal.Delete
Copyright : Flipstone Technology Partners 2021
License   : MIT
-}</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Orville.PostgreSQL.Internal.Delete</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier">Delete</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromDeleteExpr"><span class="hs-identifier">deleteFromDeleteExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#executeDelete"><span class="hs-identifier">executeDelete</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#executeDeleteReturnEntities"><span class="hs-identifier">executeDeleteReturnEntities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromTableReturning"><span class="hs-identifier">deleteFromTableReturning</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromTable"><span class="hs-identifier">deleteFromTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#rawDeleteExpr"><span class="hs-identifier">rawDeleteExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Execute.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.Execute</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Execute</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.Expr</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Expr</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.MonadOrville</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MonadOrville</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.QueryType.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.QueryType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">QueryType</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.ReturningOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#NoReturningClause"><span class="hs-identifier">NoReturningClause</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningClause"><span class="hs-identifier">ReturningClause</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningOption"><span class="hs-identifier">ReturningOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#WithReturning"><span class="hs-identifier">WithReturning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#WithoutReturning"><span class="hs-identifier">WithoutReturning</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.SelectOptions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SelectOptions</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.SqlMarshaller</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#AnnotatedSqlMarshaller"><span class="hs-identifier">AnnotatedSqlMarshaller</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html"><span class="hs-identifier">Orville.PostgreSQL.Internal.TableDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier">TableDefinition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#mkTableReturningClause"><span class="hs-identifier">mkTableReturningClause</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableMarshaller"><span class="hs-identifier">tableMarshaller</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableName"><span class="hs-identifier">tableName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">{- | Represents a @DELETE@ statement that can be executed against a database. A 'Delete' has a
  'SqlMarshaller' bound to it that, when the delete returns data from the database, will be used to
  decode the database result set when it is executed.
-}</span><span>
</span><span id="line-33"></span><span class="hs-keyword">data</span><span> </span><span id="Delete"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-var">Delete</span></a></span></span><span> </span><span id="local-6989586621679121111"><span class="annot"><a href="#local-6989586621679121111"><span class="hs-identifier hs-type">readEntity</span></a></span></span><span> </span><span id="local-6989586621679121110"><span class="annot"><a href="#local-6989586621679121110"><span class="hs-identifier hs-type">returningClause</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>  </span><span id="local-6989586621679121123"><span id="Delete"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-var">Delete</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Delete.html#DeleteExpr"><span class="hs-identifier hs-type">Expr.DeleteExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121123"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#NoReturningClause"><span class="hs-identifier hs-type">NoReturningClause</span></a></span></span><span>
</span><span id="line-37"></span><span>  </span><span id="local-6989586621679121108"><span id="local-6989586621679121124"><span id="DeleteReturning"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#DeleteReturning"><span class="hs-identifier hs-var">DeleteReturning</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#AnnotatedSqlMarshaller"><span class="hs-identifier hs-type">AnnotatedSqlMarshaller</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121108"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121124"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Delete.html#DeleteExpr"><span class="hs-identifier hs-type">Expr.DeleteExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121124"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningClause"><span class="hs-identifier hs-type">ReturningClause</span></a></span></span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">{- |
  Extracts the query that will be run when the delete is executed. Normally you
  don't want to extract the query and run it yourself, but this function is
  useful to view the query for debugging or query explanation.
-}</span><span>
</span><span id="line-44"></span><span id="local-6989586621679121105"><span id="local-6989586621679121106"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromDeleteExpr"><span class="hs-identifier hs-type">deleteFromDeleteExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121106"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121105"><span class="hs-identifier hs-type">returningClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Delete.html#DeleteExpr"><span class="hs-identifier hs-type">Expr.DeleteExpr</span></a></span></span></span><span>
</span><span id="line-45"></span><span id="deleteFromDeleteExpr"><span class="annot"><span class="annottext">deleteFromDeleteExpr :: Delete readEntity returningClause -&gt; DeleteExpr
</span><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromDeleteExpr"><span class="hs-identifier hs-var hs-var">deleteFromDeleteExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span id="local-6989586621679121104"><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121104"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121104"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-46"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromDeleteExpr"><span class="hs-identifier hs-var">deleteFromDeleteExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#DeleteReturning"><span class="hs-identifier hs-type">DeleteReturning</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679121103"><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121103"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121103"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">{- |
  Excutes the database query for the 'Delete' and returns the number of
  rows affected by the query.
-}</span><span>
</span><span id="line-52"></span><span id="local-6989586621679121101"><span id="local-6989586621679121102"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#executeDelete"><span class="hs-identifier hs-type">executeDelete</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121101"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#NoReturningClause"><span class="hs-identifier hs-type">NoReturningClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="#local-6989586621679121102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-56"></span><span id="executeDelete"><span class="annot"><span class="annottext">executeDelete :: Delete readEntity NoReturningClause -&gt; m Int
</span><a href="Orville.PostgreSQL.Internal.Delete.html#executeDelete"><span class="hs-identifier hs-var hs-var">executeDelete</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span id="local-6989586621679121100"><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121100"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="annottext">QueryType -&gt; DeleteExpr -&gt; m Int
forall (m :: * -&gt; *) sql.
(MonadOrville m, SqlExpression sql) =&gt;
QueryType -&gt; sql -&gt; m Int
</span><a href="Orville.PostgreSQL.Internal.Execute.html#executeAndReturnAffectedRows"><span class="hs-identifier hs-var">Execute.executeAndReturnAffectedRows</span></a></span><span> </span><span class="annot"><span class="annottext">QueryType
</span><a href="Orville.PostgreSQL.Internal.QueryType.html#DeleteQuery"><span class="hs-identifier hs-var">QueryType.DeleteQuery</span></a></span><span> </span><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121100"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">{- | Excutes the database query for the 'Delete' and uses its 'SqlMarshaller' to decode the rows (that
  were just deleteed) as returned via a RETURNING clause.
-}</span><span>
</span><span id="line-62"></span><span id="local-6989586621679121096"><span id="local-6989586621679121097"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#executeDeleteReturnEntities"><span class="hs-identifier hs-type">executeDeleteReturnEntities</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.MonadOrville.html#MonadOrville"><span class="hs-identifier hs-type">MonadOrville.MonadOrville</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121097"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121096"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningClause"><span class="hs-identifier hs-type">ReturningClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="#local-6989586621679121097"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679121096"><span class="hs-identifier hs-type">readEntity</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-66"></span><span id="executeDeleteReturnEntities"><span class="annot"><span class="annottext">executeDeleteReturnEntities :: Delete readEntity ReturningClause -&gt; m [readEntity]
</span><a href="Orville.PostgreSQL.Internal.Delete.html#executeDeleteReturnEntities"><span class="hs-identifier hs-var hs-var">executeDeleteReturnEntities</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#DeleteReturning"><span class="hs-identifier hs-type">DeleteReturning</span></a></span><span> </span><span id="local-6989586621679121095"><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679121095"><span class="hs-identifier hs-var">marshaller</span></a></span></span><span> </span><span id="local-6989586621679121094"><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121094"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="annottext">QueryType
-&gt; DeleteExpr
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; m [readEntity]
forall (m :: * -&gt; *) sql writeEntity readEntity.
(MonadOrville m, SqlExpression sql) =&gt;
QueryType
-&gt; sql
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; m [readEntity]
</span><a href="Orville.PostgreSQL.Internal.Execute.html#executeAndDecode"><span class="hs-identifier hs-var">Execute.executeAndDecode</span></a></span><span> </span><span class="annot"><span class="annottext">QueryType
</span><a href="Orville.PostgreSQL.Internal.QueryType.html#DeleteQuery"><span class="hs-identifier hs-var">QueryType.DeleteQuery</span></a></span><span> </span><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121094"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679121095"><span class="hs-identifier hs-var">marshaller</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">{- |
  Builds a 'Delete' that will delete all of the writeable columns described in the
  'TableDefinition' without returning the data as seen by the database.
-}</span><span>
</span><span id="line-73"></span><span id="local-6989586621679121090"><span id="local-6989586621679121091"><span id="local-6989586621679121092"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromTable"><span class="hs-identifier hs-type">deleteFromTable</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121092"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121091"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121090"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121090"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#NoReturningClause"><span class="hs-identifier hs-type">NoReturningClause</span></a></span></span></span></span><span>
</span><span id="line-77"></span><span id="deleteFromTable"><span class="annot"><span class="annottext">deleteFromTable :: TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition -&gt; Delete readEntity NoReturningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromTable"><span class="hs-identifier hs-var hs-var">deleteFromTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">ReturningOption NoReturningClause
-&gt; TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition
-&gt; Delete readEntity NoReturningClause
forall returningClause key writeEntity readEntity.
ReturningOption returningClause
-&gt; TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition
-&gt; Delete readEntity returningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#deleteTable"><span class="hs-identifier hs-var">deleteTable</span></a></span><span> </span><span class="annot"><span class="annottext">ReturningOption NoReturningClause
</span><a href="Orville.PostgreSQL.Internal.ReturningOption.html#WithoutReturning"><span class="hs-identifier hs-var">WithoutReturning</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">{- |
  Builds a 'Delete' that will delete all of the writeable columns described in the
  'TableDefinition' and returning the data as seen by the database. This is useful for getting
  database managed columns such as auto-incrementing identifiers and sequences.
-}</span><span>
</span><span id="line-85"></span><span id="local-6989586621679121086"><span id="local-6989586621679121087"><span id="local-6989586621679121088"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromTableReturning"><span class="hs-identifier hs-type">deleteFromTableReturning</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121088"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121087"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121086"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121086"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningClause"><span class="hs-identifier hs-type">ReturningClause</span></a></span></span></span></span><span>
</span><span id="line-89"></span><span id="deleteFromTableReturning"><span class="annot"><span class="annottext">deleteFromTableReturning :: TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition -&gt; Delete readEntity ReturningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#deleteFromTableReturning"><span class="hs-identifier hs-var hs-var">deleteFromTableReturning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="annottext">ReturningOption ReturningClause
-&gt; TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition
-&gt; Delete readEntity ReturningClause
forall returningClause key writeEntity readEntity.
ReturningOption returningClause
-&gt; TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition
-&gt; Delete readEntity returningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#deleteTable"><span class="hs-identifier hs-var">deleteTable</span></a></span><span> </span><span class="annot"><span class="annottext">ReturningOption ReturningClause
</span><a href="Orville.PostgreSQL.Internal.ReturningOption.html#WithReturning"><span class="hs-identifier hs-var">WithReturning</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- an internal helper function for creating a delete with a given `ReturningOption`</span><span>
</span><span id="line-93"></span><span id="local-6989586621679121160"><span id="local-6989586621679121161"><span id="local-6989586621679121162"><span id="local-6989586621679121163"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#deleteTable"><span class="hs-identifier hs-type">deleteTable</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningOption"><span class="hs-identifier hs-type">ReturningOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121163"><span class="hs-identifier hs-type">returningClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.TableDefinition.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121162"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121161"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121160"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#WhereCondition"><span class="hs-identifier hs-type">SelectOptions.WhereCondition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121160"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121163"><span class="hs-identifier hs-type">returningClause</span></a></span></span></span></span></span><span>
</span><span id="line-98"></span><span id="deleteTable"><span class="annot"><span class="annottext">deleteTable :: ReturningOption returningClause
-&gt; TableDefinition key writeEntity readEntity
-&gt; Maybe WhereCondition
-&gt; Delete readEntity returningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#deleteTable"><span class="hs-identifier hs-var hs-var">deleteTable</span></a></span></span><span> </span><span id="local-6989586621679121085"><span class="annot"><span class="annottext">ReturningOption returningClause
</span><a href="#local-6989586621679121085"><span class="hs-identifier hs-var">returningOption</span></a></span></span><span> </span><span id="local-6989586621679121084"><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679121084"><span class="hs-identifier hs-var">tableDef</span></a></span></span><span> </span><span id="local-6989586621679121083"><span class="annot"><span class="annottext">Maybe WhereCondition
</span><a href="#local-6989586621679121083"><span class="hs-identifier hs-var">whereCondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679121082"><span class="annot"><span class="annottext">deleteExpr :: DeleteExpr
</span><a href="#local-6989586621679121082"><span class="hs-identifier hs-var hs-var">deleteExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">Qualified TableName
-&gt; Maybe WhereClause -&gt; Maybe ReturningExpr -&gt; DeleteExpr
</span><a href="Orville.PostgreSQL.Internal.Expr.Delete.html#deleteExpr"><span class="hs-identifier hs-var">Expr.deleteExpr</span></a></span><span>
</span><span id="line-101"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity -&gt; Qualified TableName
forall key writeEntity readEntity.
TableDefinition key writeEntity readEntity -&gt; Qualified TableName
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableName"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679121084"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(WhereCondition -&gt; WhereClause)
-&gt; Maybe WhereCondition -&gt; Maybe WhereClause
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-103"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BooleanExpr -&gt; WhereClause
</span><a href="Orville.PostgreSQL.Internal.Expr.Where.WhereClause.html#whereClause"><span class="hs-identifier hs-var">Expr.whereClause</span></a></span><span> </span><span class="annot"><span class="annottext">(BooleanExpr -&gt; WhereClause)
-&gt; (WhereCondition -&gt; BooleanExpr) -&gt; WhereCondition -&gt; WhereClause
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WhereCondition -&gt; BooleanExpr
</span><a href="Orville.PostgreSQL.Internal.SelectOptions.WhereCondition.html#whereConditionToBooleanExpr"><span class="hs-identifier hs-var">SelectOptions.whereConditionToBooleanExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>              </span><span class="annot"><span class="annottext">Maybe WhereCondition
</span><a href="#local-6989586621679121083"><span class="hs-identifier hs-var">whereCondition</span></a></span><span>
</span><span id="line-105"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReturningOption returningClause
-&gt; TableDefinition key writeEntity readEntity
-&gt; Maybe ReturningExpr
forall returningClause key writeEntity readEntty.
ReturningOption returningClause
-&gt; TableDefinition key writeEntity readEntty -&gt; Maybe ReturningExpr
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#mkTableReturningClause"><span class="hs-identifier hs-var">mkTableReturningClause</span></a></span><span> </span><span class="annot"><span class="annottext">ReturningOption returningClause
</span><a href="#local-6989586621679121085"><span class="hs-identifier hs-var">returningOption</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679121084"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ReturningOption returningClause
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; DeleteExpr
-&gt; Delete readEntity returningClause
forall returningClause writeEntity readEntity.
ReturningOption returningClause
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; DeleteExpr
-&gt; Delete readEntity returningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#rawDeleteExpr"><span class="hs-identifier hs-var">rawDeleteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ReturningOption returningClause
</span><a href="#local-6989586621679121085"><span class="hs-identifier hs-var">returningOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
forall key writeEntity readEntity.
TableDefinition key writeEntity readEntity
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="Orville.PostgreSQL.Internal.TableDefinition.html#tableMarshaller"><span class="hs-identifier hs-var">tableMarshaller</span></a></span><span> </span><span class="annot"><span class="annottext">TableDefinition key writeEntity readEntity
</span><a href="#local-6989586621679121084"><span class="hs-identifier hs-var">tableDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DeleteExpr
</span><a href="#local-6989586621679121082"><span class="hs-identifier hs-var">deleteExpr</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">{- |
  Builds a 'Delete' that will execute the specified query and use the given
  'SqlMarshaller' to decode it. It is up to the caller to ensure that the given
  'Expr.DeleteExpr' makes sense and returns a result that the 'SqlMarshaller'
  can decode.

  This is the lowest level of escape hatch available for 'Delete'. The caller can build any query
  that Orville supports using the expression building functions, or use @RawSql.fromRawSql@ to build
  a raw 'Expr.DeleteExpr'. It is expected that the 'ReturningOption' given matches the
  'Expr.DeleteExpr'. This level of interface does not provide an automatic enforcement of the
  expectation, however failure is likely if that is not met.
-}</span><span>
</span><span id="line-121"></span><span id="local-6989586621679121132"><span id="local-6989586621679121133"><span id="local-6989586621679121134"><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#rawDeleteExpr"><span class="hs-identifier hs-type">rawDeleteExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.ReturningOption.html#ReturningOption"><span class="hs-identifier hs-type">ReturningOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121134"><span class="hs-identifier hs-type">returningClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.SqlMarshaller.html#AnnotatedSqlMarshaller"><span class="hs-identifier hs-type">AnnotatedSqlMarshaller</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121133"><span class="hs-identifier hs-type">writeEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121132"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Expr.Delete.html#DeleteExpr"><span class="hs-identifier hs-type">Expr.DeleteExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121132"><span class="hs-identifier hs-type">readEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121134"><span class="hs-identifier hs-type">returningClause</span></a></span></span></span></span><span>
</span><span id="line-122"></span><span id="rawDeleteExpr"><span class="annot"><span class="annottext">rawDeleteExpr :: ReturningOption returningClause
-&gt; AnnotatedSqlMarshaller writeEntity readEntity
-&gt; DeleteExpr
-&gt; Delete readEntity returningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#rawDeleteExpr"><span class="hs-identifier hs-var hs-var">rawDeleteExpr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ReturningOption returningClause
</span><a href="Orville.PostgreSQL.Internal.ReturningOption.html#WithReturning"><span class="hs-identifier hs-var">WithReturning</span></a></span><span> </span><span id="local-6989586621679121077"><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679121077"><span class="hs-identifier hs-var">marshaller</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
-&gt; DeleteExpr -&gt; Delete readEntity ReturningClause
forall writeEntity readEntity.
AnnotatedSqlMarshaller writeEntity readEntity
-&gt; DeleteExpr -&gt; Delete readEntity ReturningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#DeleteReturning"><span class="hs-identifier hs-var">DeleteReturning</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
</span><a href="#local-6989586621679121077"><span class="hs-identifier hs-var">marshaller</span></a></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Orville.PostgreSQL.Internal.Delete.html#rawDeleteExpr"><span class="hs-identifier hs-var">rawDeleteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ReturningOption returningClause
</span><a href="Orville.PostgreSQL.Internal.ReturningOption.html#WithoutReturning"><span class="hs-identifier hs-var">WithoutReturning</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedSqlMarshaller writeEntity readEntity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeleteExpr -&gt; Delete readEntity returningClause
forall readEntity.
DeleteExpr -&gt; Delete readEntity NoReturningClause
</span><a href="Orville.PostgreSQL.Internal.Delete.html#Delete"><span class="hs-identifier hs-var">Delete</span></a></span><span>
</span><span id="line-124"></span></pre></body></html>